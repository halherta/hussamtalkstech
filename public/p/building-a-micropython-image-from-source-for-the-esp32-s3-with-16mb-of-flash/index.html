<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="ESP32S3 in micropython">
<title>Building a Micropython image from source for the ESP32-S3 with 16MB of Flash</title>

<link rel='canonical' href='http://localhost:1313/p/building-a-micropython-image-from-source-for-the-esp32-s3-with-16mb-of-flash/'>

<link rel="stylesheet" href="/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="Building a Micropython image from source for the ESP32-S3 with 16MB of Flash">
<meta property='og:description' content="ESP32S3 in micropython">
<meta property='og:url' content='http://localhost:1313/p/building-a-micropython-image-from-source-for-the-esp32-s3-with-16mb-of-flash/'>
<meta property='og:site_name' content='Hussam Talks Tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Micropython' /><meta property='article:tag' content='ESP32' /><meta property='article:published_time' content='2024-06-17T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-06-17T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Building a Micropython image from source for the ESP32-S3 with 16MB of Flash">
<meta name="twitter:description" content="ESP32S3 in micropython">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hua084da78196c2fd09413e27ac571b6a4_468446_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Hussam Talks Tech</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/halherta'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/micropython/" style="background-color: #2a9d8f; color: #fff;">
                Micropython
            </a>
        
            <a href="/categories/esp32/" style="background-color: #2a9d8f; color: #fff;">
                ESP32
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/building-a-micropython-image-from-source-for-the-esp32-s3-with-16mb-of-flash/">Building a Micropython image from source for the ESP32-S3 with 16MB of Flash</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            ESP32S3 in micropython
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 17, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    7 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>In a <a class="link" href="/p/flashing-micropython-on-the-esp32-s3-microcontroller/" >previous blog entry</a>, I successfully flashed a pre-built micropython image on the ESP32S3 Devkit-C-v1.1 board. Unfortunately the <a class="link" href="https://micropython.org/download/ESP32_GENERIC_S3/"  target="_blank" rel="noopener"
    >official prebuilt ESP32-S3 images on the Micropython wesbite site</a>, support up to 8MB of Flash only. The ESP32S3 Devkit-C-v1.1 board (<em>ESP32-S3-DevKitC-1-N16R8V</em>) that I have has 16MB of Flash available; half of which was not detected. In order to get Micropython to utilize the entirety of the available 16MB of Flash memory, I had to build a custom Micropython image (from source).</p>
<p>The task of building a custom Micropython image can be divided into the following steps:</p>
<ul>
<li><a class="link" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32s3/get-started/linux-macos-setup.html"  target="_blank" rel="noopener"
    >Download and Install the ESP-IDF environment and all the necessary prerequisites</a></li>
<li><a class="link" href="https://github.com/micropython/micropython/tree/master/ports/esp32"  target="_blank" rel="noopener"
    >Download the Micropython source tree and install all the necessary prerequsites</a></li>
<li>Add a new board variant (with 16MB flash + octal SPIRAM) to the <strong>ESP32_GENERIC_S3</strong> board definitions folder in the Micropython source tree</li>
<li>Build a custom Micropython image based on this new variant and flash it onto the board.</li>
</ul>
<h3 id="download-and-install-the-esp-idf-environment-and-all-prerequisites">Download and Install the ESP-IDF environment and all prerequisites
</h3><p>The instructions for installing the ESP-IDF on a Linux based OS are provided <a class="link" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32s3/get-started/linux-macos-setup.html"  target="_blank" rel="noopener"
    >here</a> by Espressif. I will still go through all the steps below. Please bear in mind that the ESP-IDF SDK alone needs 1.8GB. The dev tools that it downloads (in a <code>.espressif</code> folder in the home directory) can easily eat up another 4.2GB!! Make sure you have enough hard drive space.</p>
<p>Start by installing all prerequisites. For Debian this looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>: $ sudo apt-get install git wget flex bison gperf python3 python3-pip python3-venv cmake ninja-build ccache libffi-dev libssl-dev dfu-util libusb-1.0-0
</span></span></code></pre></div><p>Then download and install the ESP-IDF; the Espressif&rsquo;s C SDK for the ESP32 family.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> : $ mkdir -p ~/Development/esp
</span></span><span style="display:flex;"><span> : $ cd ~/Development/esp
</span></span><span style="display:flex;"><span> : $ git clone -b v5.0.4 --recursive https://github.com/espressif/esp-idf.git
</span></span><span style="display:flex;"><span> : $ cd ~/esp/esp-idf
</span></span><span style="display:flex;"><span> : $ ./install.sh esp32s3
</span></span></code></pre></div><p>The last command (above) installs the tools (compiler, debugger e.t.c.) necessary for the esp32s3 only. If you&rsquo;d like to install tools for both the ESP32 and the ESP32-C3 in addition to the ESP32-S3, replace that command with <code>: ~$ ./install.sh esp32s3,esp32,esp32c3</code>.</p>
<p>Also make sure that you download a version of the ESP-IDF that&rsquo;s <a class="link" href="https://github.com/micropython/micropython/tree/master/ports/esp32"  target="_blank" rel="noopener"
    >compatible</a> with Micropython. In this tutorial version 5.0.4 of the ESP-IDF is used.</p>
<p>Once the ESP-IDF SDK is downloaded and installed, you&rsquo;ll need to load the necessary environment variables to use it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>: $ . ~/Development/esp/esp-idf/export.sh
</span></span></code></pre></div><h3 id="download-the-micropython-source-tree-and-install-all-prerequsites">Download the Micropython source tree and install all prerequsites
</h3><p>First, download all the necessary prerequisites for a Debian machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> : $ sudo apt-get install build-essential libreadline-dev libffi-dev git pkg-config gcc-arm-none-eabi libnewlib-arm-none-eabi
</span></span></code></pre></div><p>Next, download the micropython source code into the <code>~/Development</code> directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> : $ cd ~/Development
</span></span><span style="display:flex;"><span> : $ git clone --recurse-submodules https://github.com/micropython/micropython.git
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div><p>Build the MicroPython cross-compiler mpy-cross. It&rsquo;s needed to pre-compile some of the built-in scripts to bytecode.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span> : $ cd ~/Development/micropython/
</span></span><span style="display:flex;"><span> : $ make -C mpy-cross
</span></span></code></pre></div><h3 id="add-a-new-board-variant-with-16mb-flash--octal-spiram-for-the-esp32-s3">Add a new board variant (with 16MB flash + octal SPIRAM) for the ESP32-S3
</h3><p>In the Micropython source tree, go to where the ESP32 boards are, and cd into the <code>ESP32_GENERIC_S3</code> board definition folder.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span> : $ cd ~/Development/micropython/ports/esp32/boards/ESP32_GENERIC_S3
</span></span><span style="display:flex;"><span> : $ ls -al
</span></span></code></pre></div><p>You&rsquo;ll find the following files:</p>
<ul>
<li>board.json</li>
<li>board.md</li>
<li>mpconfigboard.cmake</li>
<li>mpconfigboard.h</li>
<li>sdkconfig.board</li>
<li>sdkconfig.flash_4m</li>
</ul>
<p>Let&rsquo;s take a look at <strong>board.json</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;deploy&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;../deploy_s3.md&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;docs&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;BLE&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;External Flash&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;External RAM&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;WiFi&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;images&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;generic_s3.jpg&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;mcu&#34;</span>: <span style="color:#e6db74">&#34;esp32s3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;ESP32-S3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;thumbnail&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://www.espressif.com/en/products/modules&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vendor&#34;</span>: <span style="color:#e6db74">&#34;Espressif&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;variants&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;SPIRAM_OCT&#34;</span>: <span style="color:#e6db74">&#34;Support for Octal-SPIRAM&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;FLASH_4M&#34;</span>: <span style="color:#e6db74">&#34;4MiB flash&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In the <code>variants</code> structure at the bottom, add a new variant <code>FLASH_16M_SPIRAM_OCT</code>.
The <strong>modified board.json</strong> should now look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;deploy&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;../deploy_s3.md&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;docs&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;features&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;BLE&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;External Flash&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;External RAM&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;WiFi&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;images&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;generic_s3.jpg&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;mcu&#34;</span>: <span style="color:#e6db74">&#34;esp32s3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;ESP32-S3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;thumbnail&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://www.espressif.com/en/products/modules&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vendor&#34;</span>: <span style="color:#e6db74">&#34;Espressif&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;variants&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;SPIRAM_OCT&#34;</span>: <span style="color:#e6db74">&#34;Support for Octal-SPIRAM&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;FLASH_4M&#34;</span>: <span style="color:#e6db74">&#34;4MiB flash&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;FLASH_16M_SPIRAM_OCT&#34;</span>: <span style="color:#e6db74">&#34;16MiB flash with Octal-SPIRAM&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The next file that needs to be modified is the <strong>mpconfigboard.cmake</strong>. This is what it looks like before modification:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">IDF_TARGET</span> <span style="color:#e6db74">esp32s3</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.base</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">${</span>SDKCONFIG_IDF_VERSION_SPECIFIC<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.usb</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.ble</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.spiram_sx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/ESP32_GENERIC_S3/sdkconfig.board</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">MICROPY_BOARD_VARIANT</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;SPIRAM_OCT&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">${</span>SDKCONFIG_DEFAULTS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/sdkconfig.240mhz</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/sdkconfig.spiram_oct</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    list(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">MICROPY_DEF_BOARD</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">MICROPY_HW_BOARD_NAME=</span><span style="color:#e6db74">&#34;Generic ESP32S3 module with Octal-SPIRAM&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">MICROPY_BOARD_VARIANT</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;FLASH_4M&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">${</span>SDKCONFIG_DEFAULTS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/ESP32_GENERIC_S3/sdkconfig.flash_4m</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Add a new <code>if block</code> at the bottom of the file for our new variant. The <strong>modified mpconfigboard.cmake</strong> should look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">IDF_TARGET</span> <span style="color:#e6db74">esp32s3</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.base</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">${</span>SDKCONFIG_IDF_VERSION_SPECIFIC<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.usb</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.ble</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/sdkconfig.spiram_sx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">boards/ESP32_GENERIC_S3/sdkconfig.board</span>
</span></span><span style="display:flex;"><span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">MICROPY_BOARD_VARIANT</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;SPIRAM_OCT&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">${</span>SDKCONFIG_DEFAULTS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/sdkconfig.240mhz</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/sdkconfig.spiram_oct</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    list(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">MICROPY_DEF_BOARD</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">MICROPY_HW_BOARD_NAME=</span><span style="color:#e6db74">&#34;Generic ESP32S3 module with Octal-SPIRAM&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">MICROPY_BOARD_VARIANT</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;FLASH_4M&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">${</span>SDKCONFIG_DEFAULTS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/ESP32_GENERIC_S3/sdkconfig.flash_4m</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>if(<span style="color:#e6db74">MICROPY_BOARD_VARIANT</span> <span style="color:#e6db74">STREQUAL</span> <span style="color:#e6db74">&#34;FLASH_16M_SPIRAM_OCT&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    set(<span style="color:#e6db74">SDKCONFIG_DEFAULTS</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">${</span>SDKCONFIG_DEFAULTS<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/sdkconfig.240mhz</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/sdkconfig.spiram_oct</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">boards/ESP32_GENERIC_S3/sdkconfig.flash_16m</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>     list(<span style="color:#e6db74">APPEND</span> <span style="color:#e6db74">MICROPY_DEF_BOARD</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">MICROPY_HW_BOARD_NAME=</span><span style="color:#e6db74">&#34;ESP32S3 microcontroller with 16MB of Flash &amp; Octal-SPIRAM&#34;</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>endif()<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Note that the <code>list</code> section in the last <code>if</code> block, defines the name of the board. Ideally you can place whatever you like here. It will override the board name definition in the <strong>mpconfigboard.h</strong> file and will be printed in the Micropython shell when
the board is brought out of reset.</p>
<p>Now let&rsquo;s take a quick peek at <strong>sdkconfig.flash_4m</strong>:</p>
<pre tabindex="0"><code>CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=

CONFIG_PARTITION_TABLE_CUSTOM_FILENAME=&#34;partitions-4MiB.csv&#34;
</code></pre><p><strong>DO NOT MODIFY</strong> this file. Instead create a new file called <strong>sdkconfig.flash_16m</strong>. This file was already referenced in the modification made to the <strong>mpconfigboard.cmake</strong>. The contents of the new <strong>sdkconfig.flash_16m</strong> should be:</p>
<pre tabindex="0"><code>CONFIG_ESPTOOLPY_FLASHSIZE_4MB=
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y

CONFIG_PARTITION_TABLE_CUSTOM_FILENAME=&#34;partitions-16MiB.csv&#34;
</code></pre><p>Note that the contents of the <strong>sdkconfig.flash_16m</strong> file are remarkably similar to those of the <strong>sdkconfig.flash_4m</strong>. The differences include setting the esptool FLASHSIZE variable to 16MB, and including the 16MiB partition memory file instead of the 4MiB one. The partition files theselves are already included in the Micropython source tree at <code>micropython/ports/esp32/</code>.</p>
<p>With these modifications completed, we are now ready to build the image!</p>
<h3 id="build-a-custom-micropython-image-based-on-this-new-variant">Build a custom Micropython image based on this new variant
</h3><p>To build the new micropython image; first load the esp-idf&rsquo;s environment variables then cd into <code>micropython/ports/esp32</code> and type the <code>make submodules</code> &amp; <code>make</code> commands as shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>: $ . ~/Development/esp/esp-idf/export.sh
</span></span><span style="display:flex;"><span>: $ cd ~/Development/micropython/ports/esp32
</span></span><span style="display:flex;"><span>: $ make submodules
</span></span><span style="display:flex;"><span>: $ make BOARD<span style="color:#f92672">=</span>ESP32_GENERIC_S3 BOARD_VARIANT<span style="color:#f92672">=</span>FLASH_16M_SPIRAM_OCT
</span></span></code></pre></div><p>The new custom micropython image files should be available at <code>~/Development/micropython/ports/esp32/build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/</code>.</p>
<p>to flash our Micropython image onto our ESP32-S3 Devkit microcontroller:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
</span></span><span style="display:flex;"><span>: $ esptool.py -p /dev/ttyUSB0 -b <span style="color:#ae81ff">460800</span> --before default_reset --after no_reset --chip esp32s3  write_flash --flash_mode dio --flash_size 16MB --flash_freq 80m 0x0 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/bootloader/bootloader.bin 0x8000 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/partition_table/partition-table.bin 0x10000 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/micropython.bin
</span></span></code></pre></div><p>The esptool command for flashing the ESP32S3 module with the custom image can be rather long. Thankfully, after the previous make command succeeds in building the image, it prints out the full flash command for you.</p>
<p>The build process also generates a single binary <code>firmware.bin</code> that combines <code>bootloader.bin</code>, <code>partition-table.bin</code> and <code>micropython.bin</code> listed above. For a shorter flash command you can try:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
</span></span><span style="display:flex;"><span>: $ esptool.py -p /dev/ttyUSB0 -b <span style="color:#ae81ff">460800</span> --before default_reset --after no_reset --chip esp32s3  write_flash --flash_mode dio --flash_size 16MB --flash_freq 80m 0x0 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/firmware.bin
</span></span></code></pre></div><p>or this for further brevity:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
</span></span><span style="display:flex;"><span>: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 write_flash -z <span style="color:#ae81ff">0</span> build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/firmware.bin
</span></span></code></pre></div><p>Because the esp-idf&rsquo;s environment variables were loaded with the <code>export.sh</code> command, the terminal should have access to the esptool programmer via the esp-idf SDK without resorting to the use of the Python virtual environment created in the <a class="link" href="/p/flashing-micropython-on-the-esp32-s3-microcontroller/" >previous blog entry</a>.</p>
<p>After resetting the board and opening Thonny, we are greeted with the Micropython Shell shown below:</p>
<p>
<img src="fig1.png" alt="Custom Micropython Shell"  width="1107" height="669"   style="width: 100%; max-width: 800px;"/>
</p>
<p>The Micropython shell prints out the board name that we placed in the <strong>mpconfigboard.cmake</strong> file for the 16MB with SPI octal ram variant: <em>ESP32S3 microcontroller with 16MB of Flash &amp; Octal-SPIRAM</em>.</p>
<p>Now let&rsquo;s run the following Micropython script to determine how much Flash and RAM is detected:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> esp
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> gc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Available Flash: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(esp<span style="color:#f92672">.</span>flash_size()))
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Available RAM: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(gc<span style="color:#f92672">.</span>mem_free()))
</span></span></code></pre></div><p>
<img src="fig2.png" alt="Success!"  width="1107" height="669"   style="width: 100%; max-width: 800px;"/>
</p>
<p>The output is provided in the figure above. It seems that our custom Micropython build is now able to take advantage of all 16MB of available Flash memory! Success!</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/micropython/">Micropython</a>
        
            <a href="/tags/esp32/">ESP32</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/flashing-micropython-on-the-esp32-s3-microcontroller/">
        
        

        <div class="article-details">
            <h2 class="article-title">Flashing Micropython on the ESP32-S3 Microcontroller</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 Hussam Al-Hertani
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
