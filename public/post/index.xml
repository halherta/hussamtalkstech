<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Hussam Talks Tech</title>
        <link>http://localhost:1313/post/</link>
        <description>Recent content in Posts on Hussam Talks Tech</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en</language>
        <copyright>Hussam Al-Hertani</copyright>
        <lastBuildDate>Fri, 23 Aug 2024 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/post/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>MicroPython driver for the PCA9685</title>
        <link>http://localhost:1313/p/micropython-driver-for-the-pca9685/</link>
        <pubDate>Fri, 23 Aug 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/micropython-driver-for-the-pca9685/</guid>
        <description>&lt;p&gt;The PCA9685 chip is a 16 channel PWM driver with 12-bits of resolution. It&amp;rsquo;s intended to control via PWM the up to 16 LEDs. But thanks to the fact that it can output frequencies from 1526Hz down to 24Hz, it can also be used to control up to servos. Servos usually expect a 50Hz signal (20ms period). The position of the shaft is a function of the ON time. For many standard servos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1ms ON time moves the shaft to the -90 degree position.&lt;/li&gt;
&lt;li&gt;2ms ON time moves the shaft to the +90 degree position.&lt;/li&gt;
&lt;li&gt;1.5ms ON time moves the shaft to the 0 degree position.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
&lt;img src=&#34;fig1.png&#34; alt=&#34;Figure 1. Servo ON time to shaft position mapping&#34;  width=&#34;512&#34; height=&#34;376&#34;   style=&#34;width: 100%; max-width: 500px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;These exact ON times are not always followed. The beefier MG996R servos have a different set of ON times to shaft position mapping:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0.5ms ON time moves the shaft to the -90 degree position.&lt;/li&gt;
&lt;li&gt;2.5ms ON time moves the shaft to the +90 degree position.&lt;/li&gt;
&lt;li&gt;1.5ms ON time moves the shaft to the 0 degree position.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The PCA9685 chip can be controlled from a microcontroller over the I2C bus. Each one of its 16 channels can be configured to have a different duty cycle. All 16 channels however must have the same frequency which is configured by writing a value into the PRESCALE register. This value divides the frequency of the internal oscillator 25MHz into a frequency between 24Hz and 1526Hz.&lt;/p&gt;
&lt;p&gt;The duty cycle for each channel is configured via 2 pairs of registers. One pair determine when the ON pulse starts and the other pair controls when the ON pulse ends.&lt;/p&gt;
&lt;p&gt;I recently developed an Arduino shield for the PCA9685 I2C chip in KiCAD as a part of an educational board ecosystem that I call the &lt;strong&gt;IOT Innovation Platform&lt;/strong&gt;. I will introduce these boards in future blog entries.&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig2.jpeg&#34; alt=&#34;Figure 2. My PCA9685 Arduino shield / daughterboard plugged into the &amp;lt;strong&amp;gt;IOT Innovation Platform&amp;lt;/strong&amp;gt;&#34;  width=&#34;1280&#34; height=&#34;1706&#34;   style=&#34;width: 100%; max-width: 500px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;I decided to use an ESP32S3 microcontroller (also a part of the &lt;strong&gt;IOT Innovation Platform&lt;/strong&gt; ) running Micropython for testing. So I had to write PCA9685 driver program in Micropython.&lt;/p&gt;
&lt;p&gt;The PCA9685 Driver class provides low level functions that can set the PWM frequency for the PCA9685 as well as independently set the duty cycle for each one of the 16 channels either as a percentage, an ON time pulse duration, or via start and end count values for the ON Pulse.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; pca9685 &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; PCA9685Driver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; time
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Initialize PCA9685 with default I2C settings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pwm &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCA9685Driver()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Print I2C address of the device (should be 0x40)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;i2c&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;scan())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Set PWM frequency to 1200Hz and duty cycle to 60% on channel 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;set_pwm_frequency(&lt;span style=&#34;color:#ae81ff&#34;&gt;1200&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;set_pwm_dc_percent(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;time&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It also has higher level abstraction functions for servo control.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; pca9685 &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; PCA9685Driver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; time
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Initialize PCA9685 with default I2C settings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pwm &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PCA9685Driver()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Print I2C address of the device (should be 0x40)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;i2c&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;scan())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# For channels 1, 14, and 15, vary the on-time from 0.5ms to 2.5ms (ideal for 180° rotation for MG996R servos)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Set PWM frequency to 50Hz for servo control&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;set_pwm_frequency(&lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; angle &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;190&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;servo_set_angle_custom(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, angle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;# channel 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;servo_set_angle_custom(&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;, angle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;# channel 14&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;servo_set_angle_custom(&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;, angle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;# channel 15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;angle: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;angle&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        time&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; angle &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(&lt;span style=&#34;color:#ae81ff&#34;&gt;180&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;servo_set_angle_custom(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, angle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;servo_set_angle_custom(&lt;span style=&#34;color:#ae81ff&#34;&gt;14&lt;/span&gt;, angle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        pwm&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;servo_set_angle_custom(&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;, angle, &lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2.5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        print(&lt;span style=&#34;color:#e6db74&#34;&gt;f&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;angle: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;angle&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        time&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The complete PCA9685 driver class and demo code can be found on &lt;a class=&#34;link&#34; href=&#34;https://github.com/halherta/pca9685&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;my github page&lt;/a&gt;.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>UDPNode: A C&#43;&#43; class for UDP Communication</title>
        <link>http://localhost:1313/p/udpnode-a-c-class-for-udp-communication/</link>
        <pubDate>Sat, 17 Aug 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/udpnode-a-c-class-for-udp-communication/</guid>
        <description>&lt;p&gt;A couple of months ago, I decided to pursue few IOT project ideas that could benefit from basic UDP (User Datagram Protocol) communication. The MQTT and CoAP protocols are definitely more robust and secure. But there are some situations where the basic UDP protocol is sufficient. The POSIX C socket API built into Linux is quite complete; if a bit raw. And understanding said socket API; even with good command of the C programming language, can a bit daunting. Thankfully  &lt;a class=&#34;link&#34; href=&#34;https://beej.us/guide/bgnet/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Beej&amp;rsquo;s Guide to Network Programming&lt;/a&gt; does a great job of covering all aspects of socket programming. So I decided to embark on a journey of learning Linux Network / socket programming. My goal was to wrap just enough socket programming functionality within a C++ class to facilitate basic UDP communication. The result was the &lt;a class=&#34;link&#34; href=&#34;https://www.github.com/halherta/udpnode&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;UDPNode class&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;the-udpnode-class&#34;&gt;The UDPNode class
&lt;/h3&gt;&lt;p&gt;The UDPNode class facilitates UDP transmission. When a UDPNode object is instantiated, it&amp;rsquo;s bound to an IP address and port on which it listens. A receive event loop is initialized as a thread. The purpose of the receive event loop is to capture datagrams sent from other UDPNodes and place them in a receive queue. The received datagrams can be extracted from the receive queue at a later time for processing. The same object can also transmit a datagram to other IP address and port combinations. All received datagrams must adhere to a specific structure that is serialized / deserialized in a JSON format.&lt;/p&gt;
&lt;p&gt;This datagram structure is shown below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rxDatagram&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; srcport;   &lt;span style=&#34;color:#75715e&#34;&gt;// Source port number.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;string srcipaddr;  &lt;span style=&#34;color:#75715e&#34;&gt;// Source IP address.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    time_t time_stamp;      &lt;span style=&#34;color:#75715e&#34;&gt;// Timestamp of the received datagram.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;string msg;        &lt;span style=&#34;color:#75715e&#34;&gt;// Message content.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; crc_checksum;  &lt;span style=&#34;color:#75715e&#34;&gt;// CRC checksum of the message.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; jointhread;        &lt;span style=&#34;color:#75715e&#34;&gt;// Flag to indicate if the thread should join.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;msg&lt;/code&gt; string is the actual UDP message that&amp;rsquo;s being pushed around. Each UDPNode can receive and transmit these datagrams. Here&amp;rsquo;s an example of an application that primarily listens for datagrams:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;UDPNode.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    UDPNode node(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,true);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.startRxLoop();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    usleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;10000000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(node.rxDataAvailable()){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; datagramsavailable &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; node.rxDataQueueSize();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;( &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; datagramsavailable ; i&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            node.printDatagram(node.readRxDatagramFromQueue());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            usleep(&lt;span style=&#34;color:#ae81ff&#34;&gt;100000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.endRxLoop();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The above program instantiates a UDP node object on port 3490, using IPv6. It sets the maximum message length to 1024 bytes, the maximum message queue size to 5 and enables debug messages. The program starts the receive thread and waits 10 seconds. It then prints the contents of all datagrams available in the receive queue. Finally, it stops the receives thread before exiting the program.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s another program that transmits datagrams:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;UDPNode.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    UDPNode node(&lt;span style=&#34;color:#ae81ff&#34;&gt;5590&lt;/span&gt;, ipv6, &lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,true);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Attitude is the &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;little thing&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; that makes a big difference&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Life is too short to spend another day at war with yourself&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The best time to plant a tree was 20 years ago. The second best time is now&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Be happy for this moment. This moment is your life&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A good laugh and a long sleep are the two best cures for anythin&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The sun is a daily reminder that we too can rise again from the darkness, that we too can shine our own light&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Today is a good day to try&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    node.tx(&lt;span style=&#34;color:#ae81ff&#34;&gt;3490&lt;/span&gt;, ipv6,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;The only person you are destined to become is the person you decide to be&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This program instantiates a UDP node object that listens on port 5590, using IPv6. It sets the maximum message length to 1024 bytes, the maximum message queue size to 5 and enables debug messages. It then sends 8 messages to the listening UDP node on port 3490. If you compile both programs above and run them, you&amp;rsquo;ll witness how they interact with each other. Be sure to check out the &lt;a class=&#34;link&#34; href=&#34;https://www.github.com/halherta/udpnode&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;github repository&lt;/a&gt; for compilation instructions.&lt;/p&gt;
&lt;p&gt;This class has not been rigourously tested, so feel free to submit pull requests for adding functionality or fixing bugs!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>PCB Layout Design with KiCad Part II: Layout Creation</title>
        <link>http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/</link>
        <pubDate>Wed, 17 Jul 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/</guid>
        <description>&lt;p&gt;In this blog entry, the PCB layout for the astable multivibrator circuit schematic design covered in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/&#34; &gt;part I&lt;/a&gt;, will be created using the &lt;strong&gt;Kicad PCB Editor&lt;/strong&gt; application. Before proceeding however the user must be made aware of the two most common measurement units and how to convert between them.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_01.png&#34;
    alt=&#34;Figure 1: KiCad PCB Editor. Grid settings and coordinates&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 1: KiCad PCB Editor. Grid settings and coordinates&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;importance-of-spatial-dimensions-and-units-of-measurements-for-pcb-design&#34;&gt;Importance of spatial dimensions and units of measurements for PCB design
&lt;/h3&gt;&lt;p&gt;Schematic capture is an abstract procedure and there’s no real need to keep in mind the dimensions of component symbols, wires nor the spacing between them. A schematic simply needs to be clean, readable and presentable.&lt;/p&gt;
&lt;p&gt;When laying out a PCB however, the designer &lt;strong&gt;must&lt;/strong&gt; be aware of the dimensions of the footprints, traces e.t.c for many reasons. For starters, a PCB layout has finite space defined by the PCB’s outline (board edge). This space must be sufficient to carry all the layout footprints and traces. The traces; which act like wires, need to be sized adequately to allow enough current to flow through them. For example, a trace with a width of 12 mils can handle about 1A of current (assuming 1 \(\frac{oz}{ft^2}\) copper depth/height). If a trace needs to handle more current, then its trace width will have to be increased.&lt;/p&gt;
&lt;p&gt;Finally PCB manufacturing houses have things called design rules that they make available to their customers. These design rules usually include the minimum acceptable clearances required in a layout design. These tolerances exist because the equipment that fabricates PCB’s is only able to manufacture PCBs within prescribed dimensional tolerances. For example, a PCB manufacturing house can state as part of their design rules that the smallest distance/clearance between two copper traces must be 6mil. If the designer places two traces with a 4mil spacing between them, the PCB manufacturer will not be able to fabricate the board.&lt;/p&gt;
&lt;p&gt;The two units of measurements used to measure the dimensions of footprints, traces, clearances e.t.c are &lt;strong&gt;millimetres (mm)&lt;/strong&gt; and &lt;strong&gt;mils&lt;/strong&gt;. 1 mil is equivalent to a thousandths of an inch and is sometimes referred to as &lt;strong&gt;1 thou&lt;/strong&gt;. In the past, the imperial unit mils used to be more popular in the PCB design and electronics world. This is why through-hole dual inline packages (DIP), a technology developed in the 70&amp;rsquo;s, has a pitch (spacing between the pins) of 100 mils or 0.1”. This is also the spacing used between tie-points on a breadboard. And while the metric &lt;strong&gt;mm&lt;/strong&gt; has become more dominant, the imperial &lt;strong&gt;mil&lt;/strong&gt; is still in use.  As such, it is important to be able to convert between &lt;strong&gt;mils&lt;/strong&gt; and &lt;strong&gt;mm&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;To convert from mil to mm:&lt;/p&gt;
$$ Val_{mm} = \frac{Val_{mil} \times 25.4}{1000} $$
&lt;p&gt;To convert from mm to mil:&lt;/p&gt;
$$ Val_{mil} = \frac{Val_{mm} \times 1000}{25.4} $$
&lt;p&gt;When placing moving components/traces, one must also be aware of the spacing being used by the KiCad PCB editor. The grid size can be changed via the dropdown menu shown in Figure 1. The grid units can also be changed via the icons in the left toolbar. In the grid size dropdown menu, you&amp;rsquo;ll notice that the first 12 entries are in mils (whole numbers) whereas the last 10 entries measurements are in mm (whole numbers).&lt;/p&gt;
&lt;p&gt;The designer will want to alternate between finer and coarser grid settings during the layout process. When placing large components or drawing the PCB outline, use coarse grid setting like 10-50mil or 2.5-5mm. When placing smaller parts or laying out traces, the designer will want to switch to finer settings like 1-5 mils or 0.1-0.5mm. Custom grid sizes may also be set if needed.&lt;/p&gt;
&lt;p&gt;The cursor coordinates can be determined by looking at the bottom status bar. The X/Y coordinates are defined with respect to the top left corner of the white outline defining the work area. The second set of coordinates; dx/dy, are defined with respect to a user-defined/false origin. This false origin can be set anywhere in the work area simply by moving the cursor there and pressing &lt;em&gt;space bar&lt;/em&gt;. The false origin will come in very handy when sizing the PCB outline.&lt;/p&gt;
&lt;h3 id=&#34;import-netlist&#34;&gt;Import Netlist.
&lt;/h3&gt;&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_02.png&#34;
    alt=&#34;Figure 2: Update from PCB&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 2: Update from PCB&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The next step is to import the netlist (design) created in the schematic editor into the layout editor. This is accomplished by pressing F8 or the icon shown in Figure 2 in the top toolbar. The &lt;em&gt;Update PCB from Schematic&lt;/em&gt; dialog pops up as shown in Figure 3. Press the &lt;em&gt;Update PCB&lt;/em&gt; button to see all the parts and the ratsnest connecting them.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_03.png&#34;
    alt=&#34;Figure 3: Update from PCB Dialog&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 3: Update from PCB Dialog&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Move the cursor to the top left corner of the layout editor&amp;rsquo;s work area and leave them there for now.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_04.png&#34;
    alt=&#34;Figure 4: Component footprints&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 4: Component footprints&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;board-setup-and-establishing-the-design-rules&#34;&gt;Board Setup and Establishing the Design Rules
&lt;/h3&gt;&lt;p&gt;Before proceeding with the layout, let&amp;rsquo;s have a look at the board setup. The &lt;em&gt;Board Setup&lt;/em&gt; dialog can be accessed through the &lt;em&gt;File&lt;/em&gt; Menu or green icon with red gear wheel in the top left corner (top toolbar).&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_05.png&#34;
    alt=&#34;Figure 5: Board Setup - Board Editor Layers&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 5: Board Setup - Board Editor Layers&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In the &lt;em&gt;Board Editor Layers&lt;/em&gt; sub dialog, we can see all the different layers that we can access in the design.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_06.png&#34;
    alt=&#34;Figure 6: Board Setup - Physical Stackup&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 6: Board Setup - Physical Stackup&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In the &lt;em&gt;Physical Stackup&lt;/em&gt; sub dialog we can select the number of layers in the board. Two is the default, and we will leave that as is. You would need to change this value if you want to build a 4-12 layer board.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_07.png&#34;
    alt=&#34;Figure 7: Board Setup - Constraints (Design Rules)&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 7: Board Setup - Constraints (Design Rules)&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In the &lt;em&gt;constraints&lt;/em&gt; sub dialogs we have KiCad&amp;rsquo;s default design rules. These can be modified to meet PCB manufacturing house requirements. The default rules are adequate for our purposes. So leave them as is for now.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_08.png&#34;
    alt=&#34;Figure 8: Board Setup - Pre-defined Sizes&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 8: Board Setup - Pre-defined Sizes&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In the &lt;em&gt;Pre-defined Sizes&lt;/em&gt; sub dialog, custom trace widths and via dimensions can be specified. Let&amp;rsquo;s add a custom trace size of 12 mils (0.3048mm) and custom vias  size of 30 mil (0.762mm) and hole of 15 mil (0.381mm). This will now show in the drop down menus beneath the top toolbar in the main KiCad layout editor window.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_09.png&#34;
    alt=&#34;Figure 9: Board Setup - Net Classes&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 9: Board Setup - Net Classes&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Finally,  in the &lt;em&gt;Net Classes&lt;/em&gt; sub dialog, we can assign Nets (wires in our design) to Net classes with distinct trace widths. This will come in handy in future designs where we may want to have traces with different widths (to handle different currents; say &lt;em&gt;signal&lt;/em&gt; and &lt;em&gt;power&lt;/em&gt; net classes) in the same layout.&lt;/p&gt;
&lt;p&gt;Click &lt;em&gt;OK&lt;/em&gt; to exit the dialog.&lt;/p&gt;
&lt;h3 id=&#34;create-the-pcb-outline&#34;&gt;Create the PCB Outline
&lt;/h3&gt;&lt;p&gt;Just like in the schematic editor, the layout editor also has many hotkeys that you ought to familiarize yourself with. The hotkeys list can be accessed via Ctrl-F1 or through the &lt;em&gt;Help&lt;/em&gt; menu.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_10.png&#34;
    alt=&#34;Figure 10: Board Edge Creation&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 10: Board Edge Creation&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;To create a PCB outline:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Select the &lt;em&gt;Edge.cuts&lt;/em&gt; layer from the layer manager on the right hand side of the layout editor window.&lt;/li&gt;
&lt;li&gt;Set the Grid size to 5mm (coarsest metric settings) from the top drop-down menus&lt;/li&gt;
&lt;li&gt;Select the &lt;em&gt;Draw a Rectangle&lt;/em&gt;  icon on the right toolbar.&lt;/li&gt;
&lt;li&gt;Move the cursor to a location to start drawing the a square 50mmx80mm PCB outline.&lt;/li&gt;
&lt;li&gt;Press spacebar to set the false origin to this same location&lt;/li&gt;
&lt;li&gt;Left click the mouse to start drawing the PCB outline and move down &lt;strong&gt;50mm&lt;/strong&gt;, and right &lt;strong&gt;80mm&lt;/strong&gt;, left click again to finish. Alternatively you can use the keyboard arrows to move the cursor. Press enter once to stop.&lt;/li&gt;
&lt;li&gt;Press the Escape button to get back to select mode.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This will give us a rectangular board edge with sharp corners. Ideally we&amp;rsquo;d like to convert these sharp corners to smoother, &amp;lsquo;more round&amp;rsquo; corners. To achieve this;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Select the board edge and right click. A the context menu will pop-up.&lt;/li&gt;
&lt;li&gt;Choose &lt;em&gt;Shape Modification -&amp;gt; Fille Lines&lt;/em&gt;. A tiny &lt;em&gt;Fillet Lines&lt;/em&gt; dialog will pop-up.&lt;/li&gt;
&lt;li&gt;Change the fillet radius to 5mm and press OK. The corners should now be round as shown in Figure 10.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;placing-mounting-holes-and-components&#34;&gt;Placing Mounting holes and Components
&lt;/h3&gt;&lt;p&gt;Mounting holes should be included in all PCB designs. They also ought to be integrated in the PCB layout as early as possible.  Be sure to set the grid size to a finer setting; say 0.25mm.&lt;/p&gt;
&lt;p&gt;For this particular board, place one mounting hole close to each corner on the PCB outline as shown in Figure 11. Try to make the placement as symmetric as possible (use the grids!!).&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_11.png&#34;
    alt=&#34;Figure 11: Placing Mounting holes and Components&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 11: Placing Mounting holes and Components&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;To place components on the board, simply move them over into the PCB outline area. Move all components excluding the battery holder into the PCB outline. You can use the context menu or the &lt;em&gt;m&lt;/em&gt; hotkey. The battery holder will be placed last, since it will be mounted on to the bottom of the board. To achieve this, press the &lt;em&gt;f&lt;/em&gt; hot key to flip it. Notice how the silkscreen switches colour from yellow (top silkscreen) to pink (bottom silkscreen)&lt;/p&gt;
&lt;p&gt;Parts placement is one of the most important steps in layout design. Putting some thought into how each component is placed relative to other components will help reduce routing conflicts and make the trace routing step (next step) much easier.&lt;/p&gt;
&lt;p&gt;If two components are connected directly to each other in the schematic, be sure to place them as closely as possible in the layout in a way that minimizes the criss-crossing of the ratsnest lines (white lines connecting footprints together…more on this in the next paragraph). One possible placement is shown in Figure 11.&lt;/p&gt;
&lt;h3 id=&#34;add-two-ground-planes&#34;&gt;Add Two Ground planes
&lt;/h3&gt;&lt;p&gt;Printed circuit boards can have from 1 to more than 50 routing copper layers. I like to have a minimum of 2 layers for simpler designs like this one. Two layer boards allow the designer to route traces between components on the front copper layer (top side of the board) as well as the back copper layer (bottom side of the board). In fact, one can start a trace in one layer, use a via to switch over to the other layer and continue to draw the rest of the trace on this new layer!. But what do we do with all the board real estate on both layers that is not used by traces or vias?&lt;/p&gt;
&lt;p&gt;A ground plane is created by assigning all the unused copper fill (portions of copper fill not used for traces/pads/vias) on both top and bottom layers to the ground net. This has the following advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reduces noise&lt;/li&gt;
&lt;li&gt;Improves signal integrity.&lt;/li&gt;
&lt;li&gt;Because the ground net is available almost everywhere on the board, ground trace routes may not be needed, reducing the complexity of the trace routing procedure.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_12.png&#34;
    alt=&#34;Figure 12: Assigning Ground Net to the top and bottom copper fills at once&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 12: Assigning Ground Net to the top and bottom copper fills at once&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In most 2 layer designs with traces, the goal is to route as many traces as possible on the top layer along with a top ground copper fill that covers the unused areas. Traces are routed on the bottom layer only when necessary, allowing as much as possible of the bottom layer to be utilized as a &lt;em&gt;contiguous&lt;/em&gt; ground fill/net. Since our design is relatively simple, we should use only the front (top) layer for trace routing. And assign ground copper fills ( or planes) to both the back (bottom) layer, and the unused portions of the front layer.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_13.png&#34;
    alt=&#34;Figure 13: Copper Fills added successfully&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 13: Copper Fills added successfully&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;To add a ground plane,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set the Grid size back to 5mm (coarsest metric settings) from the top drop-down menus&lt;/li&gt;
&lt;li&gt;Select the &lt;em&gt;Add a filled zone&lt;/em&gt; icon from the right toolbar or use the hotkey Ctrl-Shift-Z.&lt;/li&gt;
&lt;li&gt;Place the cursor on the top left corner of the PCB outline and left click the mouse. You will be greeted with a &lt;em&gt;Copper Zone Properties&lt;/em&gt; dialog.&lt;/li&gt;
&lt;li&gt;Be sure to select both the front copper (F.Cu) and bottom copper (B.Cu) layers and the GND net as shown in figure 13. Then press OK. Move the cursor to all four corners (follow the same path as that of the PCB outline) on the board to successfully place the ground plane.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;route-traces&#34;&gt;Route Traces
&lt;/h3&gt;&lt;p&gt;The blue lines connecting the footprints to each other in Figure 13 are called the &lt;strong&gt;ratsnest&lt;/strong&gt;. They indicate where the copper traces need to go to connect the components as per the schematic (netlist). This process is called &lt;em&gt;manual routing&lt;/em&gt; when done by the PCB layout designer. Routing can also be done automatically (autorouting) by a computer algorithm, but in many cases the designer will want to route traces manually. To route these traces manually click the &lt;strong&gt;Route tracks&lt;/strong&gt; icon from the left toolbar or use the &lt;em&gt;Shift+x&lt;/em&gt; hotkey.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Always be sure to exit or enter pads (end routes) at the N, S, E and W points. Avoid diagonal routes leaving from or entering to the pads. Also avoid 90 degree turns in your routes.&lt;/strong&gt;&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_14.png&#34;
    alt=&#34;Figure 14: Successfully routed traces&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 14: Successfully routed traces&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Set the Grid size back to 0.25-0.1mm.&lt;/li&gt;
&lt;li&gt;Route all tracks (matching the ratsnest) in front copper (F.Cu) only. This process can be tricky. Try doing it yourself and refer to figure 14 only if you need help. Notice that you will not need to route the ground traces as shown in Figure 14.&lt;/li&gt;
&lt;li&gt;Select the battery holder footprint, flip it (if not done so already) so that it&amp;rsquo;s mounted on the bottom layer by using the &amp;lsquo;f&amp;rsquo; hotkey. Then place it as shown in figure 14. Route the traces attached to it. Again you will not need to route the ground net for now.&lt;/li&gt;
&lt;li&gt;Click on &lt;em&gt;Add a filled zone&lt;/em&gt; icon again. Move the cursor inside the layout and right click. Go to &lt;em&gt;Zones-&amp;gt;Fill All Zones&lt;/em&gt; This will fill in the copper fill. The board should now look as shown in Figure 15.  If you make any modification to your board i.e. move a trace or part e.t.c., you&amp;rsquo;ll have to repeat this step again. You can also turn OFF the zones by clicking on the &lt;em&gt;Show only zone boundaries&lt;/em&gt; icon in the left toolbar.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_15.png&#34;
    alt=&#34;Figure 15: Copper fills filled&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 15: Copper fills filled&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Notice that the ground pins on the transistors and the battery holder are connected directly to the ground copper fills via spokes. These spokes are called &amp;rsquo;thermal reliefs&amp;rsquo;. It can be hard to get solder to reflow on pads that are directly connected to copper fills because the heat dissipates across the entire copper fill. Thermal reliefs allow us to have our cake and eat it too; i.e.provide a robust electrical connection from the pad to the copper fill, while preventing the heat needed for soldering from dissipating into the copper fill.&lt;/p&gt;
&lt;h3 id=&#34;design-rule-check&#34;&gt;Design Rule Check
&lt;/h3&gt;&lt;p&gt;In order to verify that the PCB layout has so far respected the design rules, run a design rule check (DRC). This can be accomplished via Inspect-&amp;gt;Design Rule Checker. This opens the DRC Control dialog. Then click on the Run DRC button shown in Figure @fig:18.&lt;/p&gt;
&lt;p&gt;Any problems listed under &lt;em&gt;Violations&lt;/em&gt; must be rectified. Also the &lt;em&gt;Unconnected Items&lt;/em&gt; should be zero, if its more than zero, this indicates that you forgot to route some of the traces.&lt;/p&gt;
&lt;p&gt;If the DRC passes without any problems and no unconnected nets, then congratulations! The layout is valid and almost complete!.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_16.png&#34;
    alt=&#34;Figure 16: Design Rule Check - No Errors!&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 16: Design Rule Check - No Errors!&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;add-text--logo&#34;&gt;Add Text &amp;amp; Logo
&lt;/h3&gt;&lt;p&gt;To add text to the Front silkscreen, select the &lt;em&gt;Add a text item&lt;/em&gt;  icon in the right toolbar &lt;em&gt;Ctrl+Shift+T&lt;/em&gt; and left click in the layout area. In the resulting dialog, write in the Text field the text to be displayed on the board. Be sure to select the front silkscreen layer (F.SilkScreen) to write text in the front silkscreen layer. The text’s size and position can also be adjusted from the very same dialog. Once you are happy with the text, simply press the OK bottom and move the text to the appropriate location on the board.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_17.png&#34;
    alt=&#34;Figure 17: Add Text to front / top silkscreen&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 17: Add Text to front / top silkscreen&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Be sure to add your name and the name of the design on to the board. Also add ON/OFF labels for the switch positions as shown in Figure 18.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_18.png&#34;
    alt=&#34;Figure 18: Text added&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 18: Text added&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Adding a logo is a little bit more complicated.  KiCad can convert logo images into a footprint that can then be added to the footprint libraries. The complete process is listed below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;First create three nested folders in your root folder &lt;em&gt;KiCadProj&lt;/em&gt; called &lt;em&gt;myLibraries/myFootprints/logos.pretty&lt;/em&gt;.
&lt;ul&gt;
&lt;li&gt;The &lt;em&gt;myLibraries&lt;/em&gt; folder will contain all custom schematic symbol and layout footprint libraries that you may decide to create in the future.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;myFootprints&lt;/em&gt; folder will contain all future custom layout footprint collections&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;logos.pretty&lt;/em&gt; is the folder that will contain all custom layout footprints that are logos. Notice that layout footprint collections must be placed into folders with a &lt;em&gt;.pretty&lt;/em&gt; extension.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;From the KiCad main window select &lt;em&gt;Image Converter&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_19.jpg&#34;
    alt=&#34;Figure 19: Smiley- use this image as a logo&#34; width=&#34;400px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 19: Smiley- use this image as a logo&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Choose a reasonable logo image that is sized around 256x256 pixels. Logos will show up better on the PCB if they are less complicated. Avoid photos. For the sake of this exercise, use the smiley logo shown in Figure 19.&lt;/li&gt;
&lt;li&gt;Once the &lt;em&gt;Image Converter&lt;/em&gt; application opens, load the logo into the application through the &lt;em&gt;Load Source Image&lt;/em&gt;  button.&lt;/li&gt;
&lt;li&gt;Be sure to set Format: to &lt;em&gt;Footprint(.kicad_mod file)&lt;/em&gt; and &lt;em&gt;Board Layer for Outline&lt;/em&gt; to &lt;em&gt;Front silk screen&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Set the &lt;em&gt;Size&lt;/em&gt; to 20 by 13.3mm and the &lt;em&gt;Black/white threshold&lt;/em&gt; to 70.&lt;/li&gt;
&lt;li&gt;Press the Export button and save the file as smiley.kicad_mod in the logos.pretty folder (Figure 21).&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_20.png&#34;
    alt=&#34;Figure 20: Import logo and convert it to footprint&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 20: Import logo and convert it to footprint&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The goal is to always have the image features be dark on a white background. If that’s not the case, experiment with the negative checkbox and the &lt;em&gt;Black/white threshold&lt;/em&gt; slider.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_21.png&#34;
    alt=&#34;Figure 21: location of smiley.kicad_mod&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 21: location of smiley.kicad_mod&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;In the PCB Editor, go to &lt;em&gt;Preferences-&amp;gt;Manage Footprint Libraries&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Select the &lt;em&gt;Global Libraries&lt;/em&gt; tab&lt;/li&gt;
&lt;li&gt;Press the &lt;em&gt;Add existing library to table button&lt;/em&gt; (folder icon) and enter a name for this library and its library path as shown in Figure 22.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_22.png&#34;
    alt=&#34;Figure 22: Add logos footprint library path to KiCad&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 22: Add logos footprint library path to KiCad&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;In the PCB ditor, select the Add Footprint icon (hotkey is &lt;em&gt;a&lt;/em&gt;), then left click anywhere within the layout editor&amp;rsquo;s grid area. This will open a &lt;em&gt;Choose Footprint&lt;/em&gt; Dialog.&lt;/li&gt;
&lt;li&gt;In this dialog go to the logos library on the left-hand side and double click on the smiley footprint as illustrated in Figure 23.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_23.png&#34;
    alt=&#34;Figure 23:Footprint Library Browser&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 23:Footprint Library Browser&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;Now place it in the PCB layout. You&amp;rsquo;ll notice a &lt;em&gt;G&lt;/em&gt;** * reference value is visible. If you select the logo and press the &amp;lsquo;E&amp;rsquo; hotkey (or right click -&amp;gt; &lt;em&gt;Properties&lt;/em&gt;), you can render the reference value invisible. The final layout with filled ground planes is shown in Figure 24.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_24.png&#34;
    alt=&#34;Figure 24: Final Layout&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 24: Final Layout&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;KiCad&amp;rsquo;s PCB Editor also comes with a 3D viewer. To access it, go to &lt;em&gt;View-&amp;gt;3D Viewer&lt;/em&gt;. Figure 25 illustrates what the board looks like in the 3D viewer.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_25.png&#34;
    alt=&#34;Figure 25: 3D view of Final Layout&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 25: 3D view of Final Layout&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;generate-gerber-files&#34;&gt;Generate Gerber files
&lt;/h3&gt;&lt;p&gt;In order to fabricate a PCB based on our layout , the layout’s Gerber files need to be generated. Gerber files contain information about the location and contents of each layer i.e. Front Copper, Front Silkscreen, Drill holes. e.t.c&lt;/p&gt;
&lt;p&gt;To generate the Gerber files:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a directory called Gerber in your project directory&lt;/li&gt;
&lt;li&gt;Select &lt;em&gt;File-&amp;gt;Plot&lt;/em&gt; from the top menu.&lt;/li&gt;
&lt;li&gt;In the plot dialog be sure to select the 7 layers shown in Figure 26.
&lt;ul&gt;
&lt;li&gt;F.Cu (.gtl) -&amp;gt; Front/Top Copper&lt;/li&gt;
&lt;li&gt;B.Cu (.gbl) -&amp;gt; Bottom Copper&lt;/li&gt;
&lt;li&gt;F.Silkscreen (.gto) -&amp;gt; Front/Top Silkscreen&lt;/li&gt;
&lt;li&gt;B.Silkscreen (.gbo) -&amp;gt; Bottom Silkscreen&lt;/li&gt;
&lt;li&gt;F.Mask (.gts) -&amp;gt; Front/Top Soldermask&lt;/li&gt;
&lt;li&gt;B.Mask (.gbs) -&amp;gt; Bottom Soldermask&lt;/li&gt;
&lt;li&gt;Edge.cuts (.gm1) -&amp;gt; Board Edge&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Under Gerber options select &lt;em&gt;Use Protel filename extensions&lt;/em&gt; as shown.&lt;/li&gt;
&lt;li&gt;Set the Output folder to &lt;em&gt;Gerbers&lt;/em&gt; and press the &lt;em&gt;Plot&lt;/em&gt; button. This will create all the necessary Gerber files (except the drill file) and place them in the &lt;em&gt;Gerbers&lt;/em&gt; folder within the project folder.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_26.png&#34;
    alt=&#34;Figure 26: Plot Gerber files&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 26: Plot Gerber files&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;To generate the drill(.drl) file:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Press the &lt;em&gt;Generate Drill files…&lt;/em&gt; button in the &lt;em&gt;Plot&lt;/em&gt; dialog. This will open a new dialog called &lt;em&gt;Generate Drill Files&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_27.png&#34;
    alt=&#34;Figure 27: Generate Drill file&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 27: Generate Drill file&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;In this dialog, be sure to set the &lt;em&gt;Drill Units&lt;/em&gt; to &lt;em&gt;Millimeters&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Under &lt;em&gt;Drill File Format&lt;/em&gt;, select &lt;em&gt;Excellon&lt;/em&gt; &amp;amp; &lt;em&gt;PTH and NPTH holes in single file&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Be sure to set the Output folder to the path of the &lt;em&gt;Gerber&lt;/em&gt; folder created earlier&lt;/li&gt;
&lt;li&gt;Press the &lt;em&gt;Generate Drill File button&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;Gerbers&lt;/em&gt; folder now holds all necessary files for fabrication!&lt;/li&gt;
&lt;li&gt;You can now view the Gerber files and drill file in the Gerber viewer accessible from the main KiCad window.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/img/img02_28.png&#34;
    alt=&#34;Figure 28: Gerber Viewer&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 28: Gerber Viewer&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;And that&amp;rsquo;s it! Compress the &lt;em&gt;Gerbers&lt;/em&gt; folder into a zip file and upload it onto your favorite PCB manufacturer website. I&amp;rsquo;m making the entire &lt;a class=&#34;link&#34; href=&#34;https://www.github.com/halherta/IntrotoKicadtut&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;KiCAD project available for download from my github&lt;/a&gt;. This has been a rather long entry. My goal is to make this tutorial available in a video format in the near future.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>PCB Layout Design with KiCad Part I: Introduction &amp; Schematic Capture</title>
        <link>http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/</link>
        <pubDate>Wed, 10 Jul 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/</guid>
        <description>&lt;p&gt;In this blog entry, I will introduce the printed circuit board (PCB) design flow. I will then proceed to focus on the schematic capture section of the PCB design flow by using the &lt;a class=&#34;link&#34; href=&#34;http://www.kicad-pcb.org&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;KiCad PCB design tool&lt;/a&gt; to create a schematic for a simple LED blinker circuit. The PCB layout section of the design flow is covered in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-ii-layout-creation/&#34; &gt;this&lt;/a&gt; blog entry.&lt;/p&gt;
&lt;h2 id=&#34;pcb-design-flow&#34;&gt;PCB Design Flow
&lt;/h2&gt;&lt;p&gt;The PCB design flow is illustrated in Figure 1. It can be broken into two major steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Schematic Creation: This is where the circuit schematic will be ‘captured’ by the PCB design tool.&lt;/li&gt;
&lt;li&gt;Layout Creation: This is where the circuit schematic will be turned into a PCB layout containing matching footprints for the various components in the circuit, and traces representing the wires/nets connecting these components.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_01.png&#34;
    alt=&#34;Figure 1: PCB Design Flow&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 1: PCB Design Flow&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Each one of these steps can be broken down into further smaller steps.&lt;/p&gt;
&lt;h3 id=&#34;schematic-creation-overview&#34;&gt;Schematic Creation Overview
&lt;/h3&gt;&lt;p&gt;A circuit schematic is an illustrative diagram demonstrating how a variety of electrical/electronic components represented by schematic symbols, are wired together.&lt;/p&gt;
&lt;p&gt;Here the designer inputs the schematic into KiCad’s schematic capture (editor) tool. If one or more components in the circuit is not available in the schematic symbols library, the designer must create a new schematic symbol and add it to the schematic. The procedure for schematic symbol creation is beyond the scope of this tutorial. It may be covered in a future blog entry.&lt;/p&gt;
&lt;p&gt;Once the schematic is completed and verified, a footprint assignment tool is then used to assign every &lt;strong&gt;schematic symbol&lt;/strong&gt; in the schematic to a &lt;strong&gt;layout footprint&lt;/strong&gt;. If one or more components (schematic symbols) in the design have no valid footprint(s) in the footprint library, the designer must create a suitable footprint, before mapping it to its appropriate schematic symbol. The procedure for layout footprint creation is yet again outside the scope of this tutorial and may be covered in a future blog entry.&lt;/p&gt;
&lt;p&gt;At this point, the user can generate the &lt;strong&gt;bill of materials (BOM)&lt;/strong&gt; list containing a list of all the components required by the schematic, and generate the &lt;strong&gt;schematic netlist&lt;/strong&gt;. The schematic netlist is simply a file that textually describes all the components and the interconnections / wiring between them as illustrated in the schematic.&lt;/p&gt;
&lt;h3 id=&#34;layout-creation-overview&#34;&gt;Layout Creation Overview
&lt;/h3&gt;&lt;p&gt;Here the designer will first open KiCad’s PCB / layout editor tool, and set the appropriate design rules for the layout. The design rules are determined by the PCB manufacturer and ensure that the KiCad layout design meets the specifications required for successful fabrication.&lt;/p&gt;
&lt;p&gt;The designer will then import the schematic &lt;em&gt;netlist&lt;/em&gt; into the layout editor tool and create the PCB’s outline via the ‘Edge.Cuts’ (board edge) layer. Copper fills / pours for ground planes and other zones are then allocated within the PCB outline.&lt;/p&gt;
&lt;p&gt;Next, all component footprints are &lt;em&gt;placed&lt;/em&gt; within the PCB outline and the traces between the components are routed (as per the wires/nets in the schematic). Once the layout is complete, the designer will perform a design rule check (DRC) to ensure that the layout meets all the design rules and can indeed be fabricated by the PCB manufacturing house. The final step is to generate the layout&amp;rsquo;s Gerber files and send them to the PCB manufacturing house for fabrication.&lt;/p&gt;
&lt;h2 id=&#34;schematic-symbol-vs-layout-footprint&#34;&gt;Schematic Symbol vs Layout Footprint
&lt;/h2&gt;&lt;p&gt;Schematic symbols denote the schematic representation of a component. For example the schematic symbol of a resistor is shown in Figure 2. Note that because a schematic symbol is an &lt;strong&gt;abstract illustration&lt;/strong&gt; representing a component, it&amp;rsquo;s exact size, placement and dimensions matters in so far as to ensure that the schematic is clear, uncluttered and legible. The size &amp;amp; position of the schematic symbol does not translate into the physical world.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_02.png&#34;
    alt=&#34;Figure 2: Resistor schematic symbol&#34; width=&#34;400px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 2: Resistor schematic symbol&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Layout footprints on the other hand are just that, the footprint representation that will be &amp;lsquo;printed on &amp;amp; drilled into&amp;rsquo; the printed circuit board.  Layout footprints typically consists of a silkscreen portion outlining the size and shape of the component to be placed, and copper through hole / surface mount pads that connect the components pins to the traces on the PCB.&lt;/p&gt;
&lt;p&gt;The dimensions of the layout footprint must match the dimensions of the component that it represents. Since the component will be placed onto its layout footprint in the physical world. The placement of the footprint must also be well thought out. Figure 3 illustrates a matching layout footprint for the resistor schematic symbol in Figure 2.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_03.png&#34;
    alt=&#34;Figure 3: Resistor layout footprint&#34; width=&#34;400px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 3: Resistor layout footprint&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;introduction-to-kicad&#34;&gt;Introduction to KiCad
&lt;/h2&gt;&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_04.png&#34;
    alt=&#34;Figure 4: Main KiCad window&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 4: Main KiCad window&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;When the KiCad application runs, the first thing the user sees is the main KiCad window, From this window, a variety of tools can be accessed including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Schematic editor - used for schematic capture&lt;/li&gt;
&lt;li&gt;Symbol (Schematic) editor - used to edit existing schematic symbols and create new ones&lt;/li&gt;
&lt;li&gt;PCB layout editor - used for PCB layout design&lt;/li&gt;
&lt;li&gt;Footprint  editor - used to edit existing layout footprints and create new ones&lt;/li&gt;
&lt;li&gt;Gerber viewer - used to inspect Gerber files&lt;/li&gt;
&lt;li&gt;Image Converter - used for creating logos from bitmap images among other things&lt;/li&gt;
&lt;li&gt;Calculator tools - used for various calculations i.e. calculate current capacity of a trace&lt;/li&gt;
&lt;li&gt;Drawing sheet editor - edit drawing sheet borders and title blocks for use in schematics and PCB designs&lt;/li&gt;
&lt;li&gt;Plugin and content Manager - Manage downloadable packages from KiCad and 3rd party repositories.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;creating-a-new-project&#34;&gt;Creating a New Project
&lt;/h3&gt;&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_05.png&#34;
    alt=&#34;Figure 5: Create a new project&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 5: Create a new project&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Create a new root directory where all KiCad projects will be saved. Call this directory &lt;em&gt;KiCadProj&lt;/em&gt; or some other relevant name,&lt;/p&gt;
&lt;p&gt;In KiCad goto &lt;em&gt;File-&amp;gt;New Project&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Create a new project called &lt;em&gt;led_blinky&lt;/em&gt; and save it in the &lt;em&gt;KiCadProj&lt;/em&gt; directory. This will automatically create a folder name &lt;em&gt;led_blinky&lt;/em&gt; under the &lt;em&gt;KiCadProj&lt;/em&gt; directory and create a &lt;strong&gt;.kicad_pro&lt;/strong&gt; project file in it. All other files related to this project i.e. schematic, layout, netlist e.t.c. will be saved into this folder.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_06.png&#34;
    alt=&#34;Figure 6: Project Created&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 6: Project Created&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h4 id=&#34;the-astable-multivibrator-circuit&#34;&gt;The Astable Multivibrator Circuit
&lt;/h4&gt;&lt;p&gt;The transistor based &lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Multivibrator&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;astable multivibrator&lt;/a&gt; circuit shown in the schematic below is a simple square wave oscillator. It generates two square waves that exhibit a 180 degree phase shift. For more on the theory behind this circuit’s operation, the curious reader can go &lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Multivibrator#Operation&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_07.png&#34;
    alt=&#34;Figure 7: Astable Multivibrator Circuit&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 7: Astable Multivibrator Circuit&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Connecting LED’s to the collector of each transistor turns the circuit into an LED flasher. The frequency of oscillation is a function of the values of R2, R3, C1 &amp;amp; C2 and is approximately equal to :&lt;/p&gt;
$$f = \frac{1}{ln(2) \times (R_2C_1 + R_3C_2)}$$
&lt;p&gt;Assuming that \(R_2 = R_3 = R \) and \(C_1 = C_2 = C \), the frequency of oscillation becomes,&lt;/p&gt;
$$f = \frac{1}{ln(2) \times RC }$$
&lt;h3 id=&#34;kicad-schematic-editor&#34;&gt;KiCad Schematic Editor
&lt;/h3&gt;&lt;p&gt;KiCad&amp;rsquo;s schematic editor is quite powerful and integrates a ton of functionality. Some of which will be covered in this section.&lt;/p&gt;
&lt;h4 id=&#34;hotkeys&#34;&gt;Hotkeys
&lt;/h4&gt;&lt;p&gt;Let&amp;rsquo;s start with the schematic editor from the KiCad main window. Before going any further, it is important to familiarize yourself with the hotkeys available within KiCad. It might not seem necessary, but it is well worth your time to memorize the hotkeys for some of the more commonly used actions.  To get the list, go to &lt;em&gt;Help-&amp;gt;List Hotkeys&lt;/em&gt; or press &lt;em&gt;Ctrl-F1&lt;/em&gt; and look under the &lt;strong&gt;Schematic Editor&lt;/strong&gt; listview. Things that can be done easily with hotkeys in the schematic editor are listed below:&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_08.png&#34;
    alt=&#34;Figure 8: KiCad Schematic Editor Hotkeys&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 8: KiCad Schematic Editor Hotkeys&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;e - Edit properties of a component&lt;/li&gt;
&lt;li&gt;m - Move a component&lt;/li&gt;
&lt;li&gt;ctrl+D - Duplicate (Copy) a component&lt;/li&gt;
&lt;li&gt;r - Rotate a component&lt;/li&gt;
&lt;li&gt;x - Mirror a component along the X axis&lt;/li&gt;
&lt;li&gt;y - Mirror a component along the Y axis&lt;/li&gt;
&lt;li&gt;a - Add a component&lt;/li&gt;
&lt;li&gt;t - Add Schematic text&lt;/li&gt;
&lt;li&gt;Delete - Delete a component&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Using these shortcuts/hotkeys will make working with KiCad much faster and efficient.&lt;/p&gt;
&lt;h4 id=&#34;page-settings&#34;&gt;Page Settings
&lt;/h4&gt;&lt;p&gt;To fill in the legend in the bottom left hand corner, go to &lt;em&gt;File-&amp;gt;Page Settings&lt;/em&gt; , and fill in the various details i.e. revision number, date, title e.t.c. The page size and orientation can also be changed from the Page Settings dialog.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_09.png&#34;
    alt=&#34;Figure 9: Edit Page Settings&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 9: Edit Page Settings&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Once you are done with the page settings,the legend will be updated as shown in Figure 10.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_10.png&#34;
    alt=&#34;Figure 10: Updated Legend&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 10: Updated Legend&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h4 id=&#34;zooming-in--out&#34;&gt;Zooming in &amp;amp; out
&lt;/h4&gt;&lt;p&gt;To quickly zoom in and out of the schematic area one can use the mouse scroll wheel. Alternatively, you can also use the zoom icons in the center of the top toolbar.&lt;/p&gt;
&lt;h4 id=&#34;schematic-capture&#34;&gt;Schematic capture
&lt;/h4&gt;&lt;p&gt;Now we add the components to the schematic! To add components, use the shortcut ‘a’ or click on the op-amp icon (triangular three pin component with a ‘+’ and ‘-’ signs on its inputs) in the top righthand corner. The following schematic symbols will be needed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Two NPN transistors.&lt;strong&gt;2N3904&lt;/strong&gt; should be fine.&lt;/li&gt;
&lt;li&gt;Four Resistors. Select Component &lt;strong&gt;R_Small_US&lt;/strong&gt;. R, R_US and R_Small can also be used.&lt;/li&gt;
&lt;li&gt;Two Capacitors. Select Component &lt;strong&gt;C_Polarized_Small_US&lt;/strong&gt;. Any capacitor symbol with polarity will work, since this circuit utilizes polarized electrolytic capacitors.&lt;/li&gt;
&lt;li&gt;Two Light emitting diodes (LED)s. Select component &lt;strong&gt;LED&lt;/strong&gt;. LED_Small can also be used.&lt;/li&gt;
&lt;li&gt;A power symbol. Select Component &lt;strong&gt;Battery&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;A ground symbol. Select Component &lt;strong&gt;GND&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Four mounting holes. Select Component &lt;strong&gt;MountingHole&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;An SPDT (single pole double throw) switch &lt;strong&gt;SW_SPDT&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once these components are added to the schematic, use hotkeys to copy (c), move(m), delete(Delete), edit part values(e), rotate (r) and/or mirror(x/y) these components as needed. You can also right click on the component and a context menu will pop up giving you similar functionality. The hotkeys will make things go faster however.&lt;/p&gt;
&lt;p&gt;Once all the parts are placed, connect them with wires. To start a wire you can use the hotkey (w) or click on the diagonal  blue wire icon (&lt;em&gt;Add a Wire&lt;/em&gt;) on the right toolbar. By default all wires are straight. To draw the diagonal wires, you’ll have to click on the &lt;em&gt;Switch H &amp;amp; V only mode for new wires and buses&lt;/em&gt; icon. It is located on the left toolbar and has a small picture of two lines cutting each other at a 90 degree angle. Alternatively, you can use the &lt;em&gt;Shift+Space&lt;/em&gt; shortcut.&lt;/p&gt;
&lt;p&gt;Additionally, make sure you add a &lt;em&gt;no connect flag&lt;/em&gt; to pin 3 of the SPDT switch (as shown in the figure below). This can be accomplished with the hotkey &lt;em&gt;Q&lt;/em&gt; or by selecting the &amp;lsquo;x&amp;rsquo; icon in the right toolbar.&lt;/p&gt;
&lt;p&gt;Once completed, the schematic should look similar the one in Figure 11. Make sure that all components are assigned the correct values.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_11.png&#34;
    alt=&#34;Figure 11: Completed schematic&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 11: Completed schematic&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h4 id=&#34;component-annotation-and-the-electrical-rule-check-erc&#34;&gt;Component Annotation and the Electrical Rule Check (ERC)
&lt;/h4&gt;&lt;p&gt;Notice that each symbol come with two textual descriptions;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a &lt;strong&gt;reference&lt;/strong&gt; such as &lt;em&gt;R1&lt;/em&gt;, &lt;em&gt;R2&lt;/em&gt;, &lt;em&gt;C1&lt;/em&gt;, &lt;em&gt;Q1&lt;/em&gt;, &lt;em&gt;D2&lt;/em&gt;, &lt;em&gt;SW1&lt;/em&gt;, &lt;em&gt;BT1&lt;/em&gt; e.t.c, and a&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt; such as &lt;em&gt;SW-SPDT&lt;/em&gt; or &lt;em&gt;LED&lt;/em&gt;. Notice that for passive components, the &lt;em&gt;name&lt;/em&gt; field ends up being set to their component values i.e. &lt;em&gt;330&lt;/em&gt;, &lt;em&gt;10u&lt;/em&gt; e.t.c.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Both fields can be modified by selecting the symbol in question and then either &lt;em&gt;right click-&amp;gt;Properties&lt;/em&gt; or pressing the &amp;lsquo;E&amp;rsquo; hotkey. It is important that each symbol in the schematic has a valid and &lt;strong&gt;unique&lt;/strong&gt; reference value. This is because each symbol is represented in the netlist via its reference value. For example you cannot have two resistors with the same reference number &lt;em&gt;R1&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;The process of giving each component a unique reference value is known as &lt;strong&gt;Component Annotation&lt;/strong&gt;. The KiCad schematic editor performs annotation for us automatically so you should not have to worry about it. Note that the reference value for each symbol consists of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a reference designator (R for resistors, C for capacitors e.t.c.), and a&lt;/li&gt;
&lt;li&gt;unique number.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Different symbols get different reference designators. A list of reference designators is provided below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resistor - &lt;strong&gt;R&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Capacitor - &lt;strong&gt;C&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Inductor - &lt;strong&gt;L&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Diode - &lt;strong&gt;D&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Transistor - &lt;strong&gt;Q&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Integrated circuit (I.C.) - &lt;strong&gt;U&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Connector - &lt;strong&gt;J&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Switch - &lt;strong&gt;SW&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Battery - &lt;strong&gt;BT&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Mounting Hole - &lt;strong&gt;H&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Add the &lt;strong&gt;PWR_FLAG&lt;/strong&gt; symbol to both the VCC (power) and GND components/symbols. The reason for this will be explained shortly. The schematic should now look similar to that shown in Figure 12.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_12.png&#34;
    alt=&#34;Figure 12: Completed Schematic with PWR_FLAG&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 12: Completed Schematic with PWR_FLAG&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The KiCad schematic editor has a built-in Electrical Rule Check (ERC). The ERC ensures that the schematic is electrically sound and that power nets (wires) are connected to an appropriate single power driver. It also highlights floating pins e.t.c.&lt;/p&gt;
&lt;p&gt;In order to run &amp;amp; pass the ERC, the current circuit needs to have a single power driver net. In our schematic that would be the VCC net. To facilitate this, attach a &lt;strong&gt;PWR_FLAG&lt;/strong&gt; symbol to both the VCC (power source) and GND (power sink) symbols.  Since this was already done, proceed to running the ERC check by clicking on the &lt;strong&gt;Perform Electrical Rules Check&lt;/strong&gt;  (checklist) icon in the top toolbar as shown in the figure below. If everything is OK, the ERC should pass successfully with no violations.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_13.png&#34;
    alt=&#34;Figure 13: ERC Passed!&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 13: ERC Passed!&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h4 id=&#34;assign-footprints-to-schematic-symbols&#34;&gt;Assign Footprints to Schematic Symbols
&lt;/h4&gt;&lt;p&gt;So far the schematic has been captured and an ERC was successfully passed. The next step is to assign a layout footprint to each schematic symbol. This is necessary to prepare our design for layout. Click on the &lt;em&gt;Assign Footprints&lt;/em&gt; icon (containing a schematic symbol of an operation amplifier and an integrated circuit footprint linked) on the top toolbar. This should open the &lt;em&gt;Assign footprints&lt;/em&gt; dialog shown in Figure 14.&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_14.png&#34;
    alt=&#34;Figure 14: Assign footprints dialog with All Symbols assigned&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 14: Assign footprints dialog with All Symbols assigned&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;In the &lt;em&gt;Assign Footprints&lt;/em&gt; dialog the designer needs to assign the layout footprints in the rightmost column to the schematic symbols (with reference values) in centre column. Notice that the leftmost column has a list of the KiCad&amp;rsquo;s builtin layout footprint libraries.&lt;/p&gt;
&lt;p&gt;The goal here is to match our schematic symbols (centre column) with appropriate layout footprints in the rightmost column. To help us achieve this goal, several filter icons are available that facilitate filtering through all the available footprints by keyword, pin count, library or search pattern.&lt;/p&gt;
&lt;p&gt;For example, assume that the design needs a AAA battery connector with two pins (power and ground), to do this one can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;turn on the filter footprint by library and select the ‘Battery’ library from the leftmost column,&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;turn on the filter footprint by pin count, which will automatically look for all footprints with a pin count of two (same as that of the BT1 schematic symbol)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;turn on the filter footprint by search keyword or pattern and type in the adjacent text box AAA, which helps homing in on all footprints with ‘AAA’ in their names.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/p/pcb-layout-design-with-kicad-part-i-introduction-schematic-capture/img/img01_15.png&#34;
    alt=&#34;Figure 15: Assigned battery holder footprint&#34; width=&#34;700px&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;Figure 15: Assigned battery holder footprint&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;This should leave us with three options. Select the &lt;em&gt;Battery:BatteryHolder_Keystone_2479_3xAAA&lt;/em&gt; footprint by clicking on it. Notice how its assigned to the BT1 schematic symbol in the centre column in Figure 14.&lt;/p&gt;
&lt;p&gt;The actual footprint can be inspected by clicking on the &lt;em&gt;View the selected footprint in the footprint viewer&lt;/em&gt; icon (IC with magnifying glass). Many of the footprints built into KiCad have part-names and/or additional dimensions information embedded in their KiCad footprint names, making it easier to search for those parts on Electronic part distributor websites like &lt;a class=&#34;link&#34; href=&#34;https://www.digikey.ca&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Digikey&lt;/a&gt; or &lt;a class=&#34;link&#34; href=&#34;https://ca.mouser.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Mouser&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In a similar manner, associate the remaining schematic symbols to the following footprints:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BT1 - Battery:BatteryHolder_Keystone_2479_3xAAA&lt;/li&gt;
&lt;li&gt;C1,C2 - Capacitor_THT:CP_Radial_D6.3mm_P2.50mm&lt;/li&gt;
&lt;li&gt;D1,D2 - LED_THT:LED_D5.0mm&lt;/li&gt;
&lt;li&gt;H1-H4 - MountingHole:MountingHole_3.2mm_M3&lt;/li&gt;
&lt;li&gt;Q1,Q2 - 2N3904:Package_TO_SOT_THT:TO-92_Inline&lt;/li&gt;
&lt;li&gt;R1-R4 - Resistor_THT:R_Axial_DIN0207_L6.3mm_D2.5mm_P10.16mm_Horizontal&lt;/li&gt;
&lt;li&gt;SW1   - Button_Switch_THT:SW_E-Switch_EG1224_SPDT_Angled&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now click on the &lt;em&gt;Apply, Save Schematic &amp;amp; Continue&lt;/em&gt; button, then the OK button.&lt;/p&gt;
&lt;p&gt;Congratulations! You have completed the schematic capture process and are now ready to layout the board. This will be covered in a future blog entry.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Building a Micropython image from source for the ESP32-S3 with 16MB of Flash</title>
        <link>http://localhost:1313/p/building-a-micropython-image-from-source-for-the-esp32-s3-with-16mb-of-flash/</link>
        <pubDate>Mon, 17 Jun 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/building-a-micropython-image-from-source-for-the-esp32-s3-with-16mb-of-flash/</guid>
        <description>&lt;p&gt;In a &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/p/flashing-micropython-on-the-esp32-s3-microcontroller/&#34; &gt;previous blog entry&lt;/a&gt;, I successfully flashed a pre-built micropython image on the ESP32S3 Devkit-C-v1.1 board. Unfortunately the &lt;a class=&#34;link&#34; href=&#34;https://micropython.org/download/ESP32_GENERIC_S3/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;official prebuilt ESP32-S3 images on the Micropython wesbite site&lt;/a&gt;, support up to 8MB of Flash only. The ESP32S3 Devkit-C-v1.1 board (&lt;em&gt;ESP32-S3-DevKitC-1-N16R8V&lt;/em&gt;) that I have has 16MB of Flash available; half of which was not detected. In order to get Micropython to utilize the entirety of the available 16MB of Flash memory, I had to build a custom Micropython image (from source).&lt;/p&gt;
&lt;p&gt;The task of building a custom Micropython image can be divided into the following steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://docs.espressif.com/projects/esp-idf/en/stable/esp32s3/get-started/linux-macos-setup.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Download and Install the ESP-IDF environment and all the necessary prerequisites&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/micropython/micropython/tree/master/ports/esp32&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Download the Micropython source tree and install all the necessary prerequsites&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add a new board variant (with 16MB flash + octal SPIRAM) to the &lt;strong&gt;ESP32_GENERIC_S3&lt;/strong&gt; board definitions folder in the Micropython source tree&lt;/li&gt;
&lt;li&gt;Build a custom Micropython image based on this new variant and flash it onto the board.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;download-and-install-the-esp-idf-environment-and-all-prerequisites&#34;&gt;Download and Install the ESP-IDF environment and all prerequisites
&lt;/h3&gt;&lt;p&gt;The instructions for installing the ESP-IDF on a Linux based OS are provided &lt;a class=&#34;link&#34; href=&#34;https://docs.espressif.com/projects/esp-idf/en/stable/esp32s3/get-started/linux-macos-setup.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt; by Espressif. I will still go through all the steps below. Please bear in mind that the ESP-IDF SDK alone needs 1.8GB. The dev tools that it downloads (in a &lt;code&gt;.espressif&lt;/code&gt; folder in the home directory) can easily eat up another 4.2GB!! Make sure you have enough hard drive space.&lt;/p&gt;
&lt;p&gt;Start by installing all prerequisites. For Debian this looks like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ sudo apt-get install git wget flex bison gperf python3 python3-pip python3-venv cmake ninja-build ccache libffi-dev libssl-dev dfu-util libusb-1.0-0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then download and install the ESP-IDF; the Espressif&amp;rsquo;s C SDK for the ESP32 family.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ mkdir -p ~/Development/esp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ cd ~/Development/esp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ git clone -b v5.0.4 --recursive https://github.com/espressif/esp-idf.git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ cd ~/esp/esp-idf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ ./install.sh esp32s3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The last command (above) installs the tools (compiler, debugger e.t.c.) necessary for the esp32s3 only. If you&amp;rsquo;d like to install tools for both the ESP32 and the ESP32-C3 in addition to the ESP32-S3, replace that command with &lt;code&gt;: ~$ ./install.sh esp32s3,esp32,esp32c3&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Also make sure that you download a version of the ESP-IDF that&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://github.com/micropython/micropython/tree/master/ports/esp32&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;compatible&lt;/a&gt; with Micropython. In this tutorial version 5.0.4 of the ESP-IDF is used.&lt;/p&gt;
&lt;p&gt;Once the ESP-IDF SDK is downloaded and installed, you&amp;rsquo;ll need to load the necessary environment variables to use it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ . ~/Development/esp/esp-idf/export.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;download-the-micropython-source-tree-and-install-all-prerequsites&#34;&gt;Download the Micropython source tree and install all prerequsites
&lt;/h3&gt;&lt;p&gt;First, download all the necessary prerequisites for a Debian machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ sudo apt-get install build-essential libreadline-dev libffi-dev git pkg-config gcc-arm-none-eabi libnewlib-arm-none-eabi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next, download the micropython source code into the &lt;code&gt;~/Development&lt;/code&gt; directory.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ cd ~/Development
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ git clone --recurse-submodules https://github.com/micropython/micropython.git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Build the MicroPython cross-compiler mpy-cross. It&amp;rsquo;s needed to pre-compile some of the built-in scripts to bytecode.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ cd ~/Development/micropython/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ make -C mpy-cross
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;add-a-new-board-variant-with-16mb-flash--octal-spiram-for-the-esp32-s3&#34;&gt;Add a new board variant (with 16MB flash + octal SPIRAM) for the ESP32-S3
&lt;/h3&gt;&lt;p&gt;In the Micropython source tree, go to where the ESP32 boards are, and cd into the &lt;code&gt;ESP32_GENERIC_S3&lt;/code&gt; board definition folder.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ cd ~/Development/micropython/ports/esp32/boards/ESP32_GENERIC_S3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; : $ ls -al
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You&amp;rsquo;ll find the following files:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;board.json&lt;/li&gt;
&lt;li&gt;board.md&lt;/li&gt;
&lt;li&gt;mpconfigboard.cmake&lt;/li&gt;
&lt;li&gt;mpconfigboard.h&lt;/li&gt;
&lt;li&gt;sdkconfig.board&lt;/li&gt;
&lt;li&gt;sdkconfig.flash_4m&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let&amp;rsquo;s take a look at &lt;strong&gt;board.json&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;deploy&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../deploy_s3.md&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;docs&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;features&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;BLE&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;External Flash&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;External RAM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;WiFi&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;images&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;generic_s3.jpg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;mcu&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;esp32s3&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ESP32-S3&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;thumbnail&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://www.espressif.com/en/products/modules&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;vendor&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Espressif&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;variants&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;SPIRAM_OCT&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Support for Octal-SPIRAM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;FLASH_4M&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;4MiB flash&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the &lt;code&gt;variants&lt;/code&gt; structure at the bottom, add a new variant &lt;code&gt;FLASH_16M_SPIRAM_OCT&lt;/code&gt;.
The &lt;strong&gt;modified board.json&lt;/strong&gt; should now look like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;deploy&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../deploy_s3.md&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;docs&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;features&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;BLE&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;External Flash&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;External RAM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;WiFi&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;images&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;generic_s3.jpg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;mcu&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;esp32s3&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ESP32-S3&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;thumbnail&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://www.espressif.com/en/products/modules&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;vendor&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Espressif&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;variants&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;SPIRAM_OCT&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Support for Octal-SPIRAM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;FLASH_4M&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;4MiB flash&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;FLASH_16M_SPIRAM_OCT&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;16MiB flash with Octal-SPIRAM&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The next file that needs to be modified is the &lt;strong&gt;mpconfigboard.cmake&lt;/strong&gt;. This is what it looks like before modification:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cmake&#34; data-lang=&#34;cmake&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;set(&lt;span style=&#34;color:#e6db74&#34;&gt;IDF_TARGET&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;esp32s3&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.base&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_IDF_VERSION_SPECIFIC&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.usb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.ble&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.spiram_sx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/ESP32_GENERIC_S3/sdkconfig.board&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;if(&lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_BOARD_VARIANT&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;STREQUAL&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SPIRAM_OCT&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_DEFAULTS&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.240mhz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.spiram_oct&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    list(&lt;span style=&#34;color:#e6db74&#34;&gt;APPEND&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_DEF_BOARD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_HW_BOARD_NAME=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Generic ESP32S3 module with Octal-SPIRAM&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;endif()&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;if(&lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_BOARD_VARIANT&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;STREQUAL&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FLASH_4M&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_DEFAULTS&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/ESP32_GENERIC_S3/sdkconfig.flash_4m&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;endif()&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Add a new &lt;code&gt;if block&lt;/code&gt; at the bottom of the file for our new variant. The &lt;strong&gt;modified mpconfigboard.cmake&lt;/strong&gt; should look like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cmake&#34; data-lang=&#34;cmake&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;set(&lt;span style=&#34;color:#e6db74&#34;&gt;IDF_TARGET&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;esp32s3&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.base&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_IDF_VERSION_SPECIFIC&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.usb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.ble&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.spiram_sx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;boards/ESP32_GENERIC_S3/sdkconfig.board&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;if(&lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_BOARD_VARIANT&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;STREQUAL&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SPIRAM_OCT&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_DEFAULTS&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.240mhz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.spiram_oct&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    list(&lt;span style=&#34;color:#e6db74&#34;&gt;APPEND&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_DEF_BOARD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_HW_BOARD_NAME=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Generic ESP32S3 module with Octal-SPIRAM&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;endif()&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;if(&lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_BOARD_VARIANT&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;STREQUAL&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FLASH_4M&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_DEFAULTS&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/ESP32_GENERIC_S3/sdkconfig.flash_4m&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;endif()&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;if(&lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_BOARD_VARIANT&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;STREQUAL&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FLASH_16M_SPIRAM_OCT&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;    set(&lt;span style=&#34;color:#e6db74&#34;&gt;SDKCONFIG_DEFAULTS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;${&lt;/span&gt;SDKCONFIG_DEFAULTS&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.240mhz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/sdkconfig.spiram_oct&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;boards/ESP32_GENERIC_S3/sdkconfig.flash_16m&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;     list(&lt;span style=&#34;color:#e6db74&#34;&gt;APPEND&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_DEF_BOARD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;MICROPY_HW_BOARD_NAME=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ESP32S3 microcontroller with 16MB of Flash &amp;amp; Octal-SPIRAM&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    )&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;endif()&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note that the &lt;code&gt;list&lt;/code&gt; section in the last &lt;code&gt;if&lt;/code&gt; block, defines the name of the board. Ideally you can place whatever you like here. It will override the board name definition in the &lt;strong&gt;mpconfigboard.h&lt;/strong&gt; file and will be printed in the Micropython shell when
the board is brought out of reset.&lt;/p&gt;
&lt;p&gt;Now let&amp;rsquo;s take a quick peek at &lt;strong&gt;sdkconfig.flash_4m&lt;/strong&gt;:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=

CONFIG_PARTITION_TABLE_CUSTOM_FILENAME=&amp;#34;partitions-4MiB.csv&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;DO NOT MODIFY&lt;/strong&gt; this file. Instead create a new file called &lt;strong&gt;sdkconfig.flash_16m&lt;/strong&gt;. This file was already referenced in the modification made to the &lt;strong&gt;mpconfigboard.cmake&lt;/strong&gt;. The contents of the new &lt;strong&gt;sdkconfig.flash_16m&lt;/strong&gt; should be:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;CONFIG_ESPTOOLPY_FLASHSIZE_4MB=
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y

CONFIG_PARTITION_TABLE_CUSTOM_FILENAME=&amp;#34;partitions-16MiB.csv&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note that the contents of the &lt;strong&gt;sdkconfig.flash_16m&lt;/strong&gt; file are remarkably similar to those of the &lt;strong&gt;sdkconfig.flash_4m&lt;/strong&gt;. The differences include setting the esptool FLASHSIZE variable to 16MB, and including the 16MiB partition memory file instead of the 4MiB one. The partition files theselves are already included in the Micropython source tree at &lt;code&gt;micropython/ports/esp32/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;With these modifications completed, we are now ready to build the image!&lt;/p&gt;
&lt;h3 id=&#34;build-a-custom-micropython-image-based-on-this-new-variant&#34;&gt;Build a custom Micropython image based on this new variant
&lt;/h3&gt;&lt;p&gt;To build the new micropython image; first load the esp-idf&amp;rsquo;s environment variables then cd into &lt;code&gt;micropython/ports/esp32&lt;/code&gt; and type the &lt;code&gt;make submodules&lt;/code&gt; &amp;amp; &lt;code&gt;make&lt;/code&gt; commands as shown below.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ . ~/Development/esp/esp-idf/export.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ cd ~/Development/micropython/ports/esp32
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ make submodules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ make BOARD&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ESP32_GENERIC_S3 BOARD_VARIANT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;FLASH_16M_SPIRAM_OCT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The new custom micropython image files should be available at &lt;code&gt;~/Development/micropython/ports/esp32/build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;to flash our Micropython image onto our ESP32-S3 Devkit microcontroller:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ esptool.py -p /dev/ttyUSB0 -b &lt;span style=&#34;color:#ae81ff&#34;&gt;460800&lt;/span&gt; --before default_reset --after no_reset --chip esp32s3  write_flash --flash_mode dio --flash_size 16MB --flash_freq 80m 0x0 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/bootloader/bootloader.bin 0x8000 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/partition_table/partition-table.bin 0x10000 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/micropython.bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The esptool command for flashing the ESP32S3 module with the custom image can be rather long. Thankfully, after the previous make command succeeds in building the image, it prints out the full flash command for you.&lt;/p&gt;
&lt;p&gt;The build process also generates a single binary &lt;code&gt;firmware.bin&lt;/code&gt; that combines &lt;code&gt;bootloader.bin&lt;/code&gt;, &lt;code&gt;partition-table.bin&lt;/code&gt; and &lt;code&gt;micropython.bin&lt;/code&gt; listed above. For a shorter flash command you can try:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ esptool.py -p /dev/ttyUSB0 -b &lt;span style=&#34;color:#ae81ff&#34;&gt;460800&lt;/span&gt; --before default_reset --after no_reset --chip esp32s3  write_flash --flash_mode dio --flash_size 16MB --flash_freq 80m 0x0 build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/firmware.bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;or this for further brevity:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;: $ esptool.py --chip esp32s3 --port /dev/ttyUSB0 write_flash -z &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; build-ESP32_GENERIC_S3-FLASH_16M_SPIRAM_OCT/firmware.bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Because the esp-idf&amp;rsquo;s environment variables were loaded with the &lt;code&gt;export.sh&lt;/code&gt; command, the terminal should have access to the esptool programmer via the esp-idf SDK without resorting to the use of the Python virtual environment created in the &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/p/flashing-micropython-on-the-esp32-s3-microcontroller/&#34; &gt;previous blog entry&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;After resetting the board and opening Thonny, we are greeted with the Micropython Shell shown below:&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig1.png&#34; alt=&#34;Custom Micropython Shell&#34;  width=&#34;1107&#34; height=&#34;669&#34;   style=&#34;width: 100%; max-width: 800px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;The Micropython shell prints out the board name that we placed in the &lt;strong&gt;mpconfigboard.cmake&lt;/strong&gt; file for the 16MB with SPI octal ram variant: &lt;em&gt;ESP32S3 microcontroller with 16MB of Flash &amp;amp; Octal-SPIRAM&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Now let&amp;rsquo;s run the following Micropython script to determine how much Flash and RAM is detected:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; esp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; gc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Available Flash: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(esp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;flash_size()))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Available RAM: &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(gc&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mem_free()))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig2.png&#34; alt=&#34;Success!&#34;  width=&#34;1107&#34; height=&#34;669&#34;   style=&#34;width: 100%; max-width: 800px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;The output is provided in the figure above. It seems that our custom Micropython build is now able to take advantage of all 16MB of available Flash memory! Success!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Flashing Micropython on the ESP32-S3 Microcontroller</title>
        <link>http://localhost:1313/p/flashing-micropython-on-the-esp32-s3-microcontroller/</link>
        <pubDate>Mon, 17 Jun 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/flashing-micropython-on-the-esp32-s3-microcontroller/</guid>
        <description>&lt;p&gt;I recently purchase an &lt;a class=&#34;link&#34; href=&#34;https://docs.espressif.com/projects/esp-idf/en/stable/esp32s3/hw-reference/esp32s3/user-guide-devkitc-1.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ESP32-S3-DevKitC-1 v1.1&lt;/a&gt; development board and wanted to program it Micropython.&lt;/p&gt;
&lt;p&gt;I got the &lt;em&gt;ESP32-S3-DevKitC-1-N16R8V&lt;/em&gt; variant with the &lt;a class=&#34;link&#34; href=&#34;https://www.espressif.com/sites/default/files/documentation/esp32-s3-wroom-2_datasheet_en.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ESP32-S3-WROOM-2-N16R8V&lt;/a&gt; module. This particular module comes with 16MB of octal SPI Flash memory and 8MB of octal SPI PSRAM; plenty of program memory and RAM for all of those Micropython objects!. In this blog entry, I will list the steps necessary to get Micropython up and running on this board!&lt;/p&gt;
&lt;p&gt;To get started, Download the latest precompiled Micropython image (Octal-SPIRAM support) from the &lt;a class=&#34;link&#34; href=&#34;https://micropython.org/download/ESP32_GENERIC_S3/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;official Micropython download page&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:~$ wget https://micropython.org/resources/firmware/ESP32_GENERIC_S3-SPIRAM_OCT-20240602-v1.23.0.bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To flash the image onto the microcontroller board, you&amp;rsquo;ll need the esptool programmer software. There are many ways of installing esptool. Since esptool is a Python application, one way to install it is via Python&amp;rsquo;s package manager &lt;em&gt;pip&lt;/em&gt;. But you&amp;rsquo;ll need to setup a virtual Python environment first. This can accomplished with the following instruction on Debian Bookworm:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:~$ mkdir -p ~/Development/PythonVirtEnvironments/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:~$ python3 -m venv ~/Development/PythonVirtEnvironments/EsptoolEnv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now activate the Python virtual environment and install the esptool programmer.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:~$ source ~/Development/PythonVirtEnvironments/EsptoolEnv/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;EsptoolEnv&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; :~$ pip install esptool
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To flash the Micropython bin file, connect the USB cable to the USB port on the left of the board (the one attached to the UART0 peripheral on the ESP32S3&amp;rsquo;s via the USB-Serial FTDI chip). Make sure that you are using the right port name. In my case that was &lt;code&gt;/dev/ttyUSB0&lt;/code&gt;. Run the following commands to: i) erase the  ESP32S3 module, &amp;amp; ii) program it with the downloaded binary:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;EsptoolEnv&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; :~$ esptool.py --chip esp32s3 --port /dev/ttyUSB0 erase_flash
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;EsptoolEnv&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; :~$ esptool.py --chip esp32s3 --port /dev/ttyUSB0 write_flash -z &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ESP32_GENERIC_S3-SPIRAM_OCT-20240602-v1.23.0.bin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You should get the following output:&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig1.png&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 1. Flashing Micropython on the EESP32-S3-DevKitC-1 v1.1 board&amp;lt;/strong&amp;gt;&#34;  width=&#34;897&#34; height=&#34;425&#34;   style=&#34;width: 100%; max-width: 700px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;Now install and run Thonny; an easy to use yet versatile Micropython IDE:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;EsptoolEnv&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; :~$ pip install thonny
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;EsptoolEnv&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; :~$ thonny
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Goto &lt;code&gt;Run-&amp;gt;Configure Interpreter&lt;/code&gt; and ensure that the &lt;code&gt;Interpreter&lt;/code&gt;tab in the &lt;code&gt;Thonny options&lt;/code&gt; looks as shown below:&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig2.png&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 2. Thonny Interpreter settings&amp;lt;/strong&amp;gt;&#34;  width=&#34;801&#34; height=&#34;714&#34;   style=&#34;width: 100%; max-width: 700px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;click &amp;lsquo;OK&amp;rsquo; on the dialog and you should be presented with the Micropython shell at the bottom of the thonny window as shown in the figure below.&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig3.png&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 3. Micropython shell ready!&amp;lt;/strong&amp;gt;&#34;  width=&#34;801&#34; height=&#34;714&#34;   style=&#34;width: 100%; max-width: 700px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;To get started, let&amp;rsquo;s see how much PSRAM and Flash are detected in the Micropython shell. To find out how much PSRAM is detected, type the following:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; gc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mem_free()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig4.png&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 4. PSRAM available&amp;lt;/strong&amp;gt;&#34;  width=&#34;872&#34; height=&#34;784&#34;   style=&#34;width: 100%; max-width: 700px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;Notice that we get &lt;code&gt;8312160&lt;/code&gt; bytes. This is close enough to the 8MB of PSRAM that we were expecting (&lt;code&gt;8388608&lt;/code&gt; bytes). The difference is very likely the memory used to launch the Micropython interpreter.&lt;/p&gt;
&lt;p&gt;What about Flash memory ?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; esp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;esp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;flash_size()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig5.png&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 5. FLASH available&amp;lt;/strong&amp;gt;&#34;  width=&#34;872&#34; height=&#34;789&#34;   style=&#34;width: 100%; max-width: 700px;&#34;/&gt;
&lt;/p&gt;
&lt;p&gt;For Flash, it looks like Micropython is only able to detect 8 of the available 16 Megabytes. The Micropython &lt;code&gt;ESP32_GENERIC_S3&lt;/code&gt; images all seem to support a maximum of 8MB even if the on module Flash memory is more. What a bummer!  I&amp;rsquo;ve seen ESP32-S3 boards with as much as 32MB of Flash being sold on Digikey. To be fair, if you purchase the &lt;strong&gt;ESP32-S3-DevKitC-1-N8R8V&lt;/strong&gt; variant of the ESP32-S3 Devkit board (with 8MB of Flash and 8MB of PSRAM), this image will be all you need.&lt;/p&gt;
&lt;p&gt;While the prebuilt Micropython build is fully functional, and the 8MB of Flash memory that it detected on our board will be enough for most projects, the fact that only half the available Flash is detected triggers my OCD a little. In a future entry, I&amp;rsquo;ll demonstrate how to build a Micropython image from source that supports the 16MB of Flash in its entirety.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Bit Manipulation in C Part I - Bit Manipulation Basics</title>
        <link>http://localhost:1313/p/bit-manipulation-in-c-part-i-bit-manipulation-basics/</link>
        <pubDate>Sun, 02 Jun 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/bit-manipulation-in-c-part-i-bit-manipulation-basics/</guid>
        <description>&lt;p&gt;The topic of bit manipulation in C doesn&amp;rsquo;t seem to get as much attention
in many C programming books and study guides. Perhaps because it&amp;rsquo;s a not
used regularly by application developers and system programmers.&lt;/p&gt;
&lt;p&gt;Knowledge of bit manipulation is however downright critical in the fields
of embedded systems, kernel space programming and device drivers programming,
where the programmer directly accesses registers i.e. talking to hardware.&lt;/p&gt;
&lt;p&gt;Programmer&amp;rsquo;s access registers directly via &lt;strong&gt;Read-Modify-Write (RMW)&lt;/strong&gt; operations.
RMW operations in turn rely heavily on bitwise operators and other parts of the C
programming language that facilitate bit manipulation. In order to understand and
correctly use RMW operations, a solid foundation in the basics of bit manipulation
must me developed. This article will attempt to provide the reader with said foundation.&lt;/p&gt;
&lt;h3 id=&#34;bitwise-operators&#34;&gt;Bitwise operators
&lt;/h3&gt;&lt;p&gt;Let us first start by introducing the bitwise operators:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Bitwise operator&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;th&gt;What it does&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&amp;amp;&lt;/td&gt;
&lt;td&gt;Bitwise AND operator&lt;/td&gt;
&lt;td&gt;&amp;lsquo;AND&amp;rsquo;s two values at the binary level&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;|&lt;/td&gt;
&lt;td&gt;Bitwise OR operator&lt;/td&gt;
&lt;td&gt;&amp;lsquo;OR&amp;rsquo;s two values at the binary level&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;^&lt;/td&gt;
&lt;td&gt;Bitwise XOR operator&lt;/td&gt;
&lt;td&gt;&amp;lsquo;XOR&amp;rsquo;s two values at the binary level&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;~&lt;/td&gt;
&lt;td&gt;Bitwise One&amp;rsquo;s complement operator&lt;/td&gt;
&lt;td&gt;Flips every bit in the register&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;gt;&amp;gt;&lt;/td&gt;
&lt;td&gt;Bitwise right shift operator&lt;/td&gt;
&lt;td&gt;Shifts a value to the right at the bit level by a specified number of bits&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&amp;lt;&amp;lt;&lt;/td&gt;
&lt;td&gt;Bitwise left shift operator&lt;/td&gt;
&lt;td&gt;Shifts a value to the left at the bit level by a specified number of bits&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Consider the code snippet below. It declares three unsigned 8 bit integer variables; a,b &amp;amp; y. And initializes a to 200, b to 56 and y to 0.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint8_t&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint8_t&lt;/span&gt; b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;56&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint8_t&lt;/span&gt; y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The One&amp;rsquo;s complement (NOT) unary operator simply flips all of the bits at a binary level as shown in Figure 1.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;a;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig1.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 1. One&amp;amp;rsquo;s complement (NOT)
operator&amp;lt;/strong&amp;gt;&#34;  width=&#34;269&#34; height=&#34;68&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;If a bitwise AND is performed between a and b, the result is 8. Note how
the bitwise AND operation performs a Boolean logical ANDing at the bit
level.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig2.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 2. Bitwise AND&amp;lt;/strong&amp;gt;&#34;  width=&#34;297&#34; height=&#34;194&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;A bitwise OR performed between a and b, results in 248.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig3.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 3. Bitwise OR&amp;lt;/strong&amp;gt;&#34;  width=&#34;287&#34; height=&#34;189&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;A bitwise XOR performed between a and b, results in 240.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig4.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 4. Bitwise XOR&amp;lt;/strong&amp;gt;&#34;  width=&#34;307&#34; height=&#34;200&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;A bitwise right shift (by three bits) performed on a, results in 25.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig5.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 5. Bitwise left &amp;amp;amp; right shifting&amp;lt;/strong&amp;gt;&#34;  width=&#34;709&#34; height=&#34;271&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;And finally, a bitwise left shift (by 3 bits)  performed on a, results in 64.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The only reason this result is only 64, is because the three most
significant bits are outside the bounds of the unsigned 8-bit integer
variable and are therefore truncated i.e. they don&amp;rsquo;t count. If a and y
where both say 16 bit unsigned integers, the result of this operation
becomes 1600.&lt;/p&gt;
&lt;p&gt;Note that &lt;strong&gt;shifting a value to the left by x bits, is equivalent to
multiplying that value by \(2^x\)&lt;/strong&gt;. This is exactly what happened here i.e.
\(200 &lt;&lt; 3\) is equivalent to 200 * \(2^3\) . More on this in the next
paragraph.&lt;/p&gt;
&lt;p&gt;At this point it is important to note that bit shifts can facilitate
multiplication and division operations by&amp;rsquo;power of two&amp;rsquo; literals. For example,
if our goal is to multiply a variable x by 8 ( \(2^3\) ), it can be achieved through
good old fashioned multiplication; or by bit shifting the variable x by 3 times to the left.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;y = x * 8;&lt;/code&gt;   is equivalent to    &lt;code&gt;y = x &amp;lt;&amp;lt; 3;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Similarly, dividing (integer division) a variable x by 8 \(2^3\), can
be achieved by bit shifting the variable x by 3 times to the right.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;y = x / 8;&lt;/code&gt;    is equivalent to    &lt;code&gt;y = x &amp;gt;&amp;gt; 3;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;You can verify all the operations mentioned so far by compiling and
running this simple C program with GCC or your favourite C compiler:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;stdint.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;uint8_t&lt;/span&gt; a,b,c,y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;uint16_t&lt;/span&gt; a16, y16;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;56&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    a16 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y16 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;200&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; The one&amp;#39;s complement (NOT) of 200 is %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Bitwise ANDING of 200 and 56 gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Bitwise ORING of 200 and 56 gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Bitwise XORING of 200 and 56 gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Bitwise left shift by 3 of the value 200 (8-bit) gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y16 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a16 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Bitwise left shift by 3 of the value 200 (16-bit) gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y16);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Bitwise right shift by 3 of the value 200 gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Multiplying the value 16 by 8 (2^3) gives %i. Bit shifting the value 16 by 3 bits to the left also gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)c&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, (&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) c&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Dividing the value 16 by 8 (2^3) gives %i. Bit shifting the value 16 by 3 bits to the right also gives %i &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;,(&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)c&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, (&lt;span style=&#34;color:#66d9ef&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) c&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;when compiling and running the above program, it outputs:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; The one&amp;#39;s complement (NOT) of 200 is 55
 Bitwise ANDING of 200 and 56 gives 8
 Bitwise ORING of 200 and 56 gives 248
 Bitwise XORING of 200 and 56 gives 240
 Bitwise left shift by 3 of the value 200 (8-bit) gives 64
 Bitwise left shift by 3 of the value 200 (16-bit) gives 1600
 Bitwise right shift by 3 of the value 200 gives 25
 Multiplying the value 16 by 8 (2^3) gives 128. Bit shifting the value 16 by 3 bits to the left also gives 128
 Dividing the value 16 by 8 (2^3) gives 2. Bit shifting the value 16 by 3 bits to the right also gives 2
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;compound-assignment-operators&#34;&gt;Compound assignment operators
&lt;/h3&gt;&lt;p&gt;The compound assignment operators consist of a binary operator (operator
that operates on two variables) and the simple assignment operator. They
perform the operation of the binary operator on both operands and store
the result of that operation into the left operand i.e. x += y adds
the values of variables x and y and stores the result back into
x. This operation is a shorthand version of x = x + y&lt;/p&gt;
&lt;p&gt;All arithmetic compound assignment operators and their expanded
equivalent operations are listed below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Compound assignment&lt;/th&gt;
&lt;th&gt;Equivalent expanded assignment&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;x &amp;lt;op&amp;gt;= y&lt;/td&gt;
&lt;td&gt;x = x &amp;lt;op&amp;gt;  y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x += y&lt;/td&gt;
&lt;td&gt;x = x + y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x -= y&lt;/td&gt;
&lt;td&gt;x = x &amp;ndash; y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x *= y&lt;/td&gt;
&lt;td&gt;x = x * y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x /= y&lt;/td&gt;
&lt;td&gt;x = x / y&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Compound assignment operator notation also works for all 2-variable
(binary) bitwise operators:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Compound assignment&lt;/th&gt;
&lt;th&gt;Expanded equivalent&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;x &amp;amp;= y&lt;/td&gt;
&lt;td&gt;x = x &amp;amp; y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x |= y&lt;/td&gt;
&lt;td&gt;x = x | y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x ^= y&lt;/td&gt;
&lt;td&gt;x = x ^ y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x &amp;lt;&amp;lt;= y&lt;/td&gt;
&lt;td&gt;x = x &amp;lt;&amp;lt; y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;x &amp;gt;&amp;gt;= y&lt;/td&gt;
&lt;td&gt;x = x &amp;gt;&amp;gt; y&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;There&amp;rsquo;s no compound assignment operator for the bitwise one&amp;rsquo;s complement
operator ~ since it a unary operator.&lt;/p&gt;
&lt;h3 id=&#34;non-decimal-numerical-representation-in-c&#34;&gt;Non-Decimal Numerical Representation in C
&lt;/h3&gt;&lt;p&gt;In C an integer number can be represented in decimal, binary,
hexadecimal and octal formats through the use of prefixes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To represent a number in decimal no prefix is needed, i.e. x = 255&lt;/li&gt;
&lt;li&gt;To represent a binary, precede it with a 0b, i.e. x = 0b11111111&lt;/li&gt;
&lt;li&gt;To represent a number in hexadecimal, precede it with a 0x, i.e. x =
0xff&lt;/li&gt;
&lt;li&gt;To represent a number in octal, precede it with 0, i.e. x = 0377&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;While the numerical representation utilized matters little to the
compiler (all numbers end up being processed in binary), in some
instances using different numerical representations when writing a
program can improve the readability of the program.&lt;/p&gt;
&lt;p&gt;Another way to represent a number is to left shift a 1 by an arbitrary
number of bits. consider the number 8. In binary, number 8 is
represented as 0b00001000. That&amp;rsquo;s basically a &amp;lsquo;1&amp;rsquo; in the third position
(start counting from right to left).
Therefore number 8 can also be represented with a left shift operation
as 1 &amp;lt;&amp;lt; 3.&lt;/p&gt;
&lt;p&gt;In a similar manner we have:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Decimal&lt;/th&gt;
&lt;th&gt;Binary equivalent&lt;/th&gt;
&lt;th&gt;Bit mask equivalent&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0b00000001&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;0b00000010&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;0b00000100&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;0b00001000&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;0b00010000&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;0b00100000&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;64&lt;/td&gt;
&lt;td&gt;0b01000000&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;128&lt;/td&gt;
&lt;td&gt;0b10000000&lt;/td&gt;
&lt;td&gt;1 &amp;lt;&amp;lt; 7&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Using this mask representation works nicely for numbers that are powers
of two. Since these numbers consist of a single &amp;lsquo;1&amp;rsquo; value (set bit) in a
particular bit position. What if we have a number that was not a power
of two, say something like 14 or 25?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Number 14 is equivalent to 8+4+2, or in binary 0b00001110. This can
be written as:  (1 &amp;lt;&amp;lt; 3) | (1 &amp;lt;&amp;lt; 2) | (1 &amp;lt;&amp;lt; 1)&lt;/li&gt;
&lt;li&gt;Number 25 is equivalent to 16+8+1 or in binary 0b00011001. This can
be written as (1 &amp;lt;&amp;lt; 4) | (1 &amp;lt;&amp;lt; 3) | (1 &amp;lt;&amp;lt; 0)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Using this approach, any positive integer can be represented using this mask
representation by either a single left shift of 1 , or by bitwise ORing
multiple left shifts of &amp;lsquo;1&amp;rsquo; !&lt;/p&gt;
&lt;p&gt;The reader is now ready to tackle &lt;strong&gt;RMW&lt;/strong&gt; operations! They will be
covered in the next article in this series.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Bit Manipulation in C Part II - Read Modify Write Operations</title>
        <link>http://localhost:1313/p/bit-manipulation-in-c-part-ii-read-modify-write-operations/</link>
        <pubDate>Sun, 02 Jun 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/p/bit-manipulation-in-c-part-ii-read-modify-write-operations/</guid>
        <description>&lt;p&gt;This article covers Read Modify Write (RMW) operations. These operations
allow the programmer to manipulate one or more bits of interest within a
variable (or register), without affecting the state of the rest of the
bits in the that variable (or register). In order to understand RMW
operations, the reader must have a solid foundation in bit manipulation.
Bit manipulation basics were covered in the &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/p/bit-manipulation-in-c-part-i-bit-manipulation-basics/&#34; &gt;Bit Manipulation in C Part 1 - Bit Manipulation basics&lt;/a&gt;
blog entry.&lt;/p&gt;
&lt;p&gt;There are four main RMW operations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Setting one or more bits in a register.&lt;/li&gt;
&lt;li&gt;Clearing one or more bits in a register.&lt;/li&gt;
&lt;li&gt;Toggling one or more bits in a register.&lt;/li&gt;
&lt;li&gt;Reading the value of a particular bit within a register.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For the rest of this blog entry variables and / or registers will be
referred to as registers for brevity. Both refer to locations in memory
where data is stored. The term register is typically used when
referencing memory locations capable of directly affecting hardware
operation of either the CPU or a hardware peripheral.&lt;/p&gt;
&lt;p&gt;The reason why these type of operations are often referred to as
&lt;strong&gt;Read-Modify-Write&lt;/strong&gt; is because they involve:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Read&lt;/strong&gt;ing the state of the register,&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Modify&lt;/strong&gt;ing the state of that register by performing a bitwise
logical operation on the value read from the register, with a bit
mask of some kind intending to modify one or more (particular) bits
within the register , and finally,&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Write&lt;/strong&gt;-ing back the result into the same register.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Only the bits of interest are modified by an RMW operation. the state of
the bits that are not of interest within the register never changes.&lt;/p&gt;
&lt;h2 id=&#34;setting-one-or-more-bits-in-a-register&#34;&gt;Setting one or more bits in a register
&lt;/h2&gt;&lt;p&gt;The first RMW operation that will be examined is the set operation. The
goal here is to set one or more bit(s) of interest in a register,
without disturbing the state of the other bits that are not of interest.
To achieve this, OR the current content of the register with a mask
value with only one(s) in the bit location(s) to be set and zeroes
elsewhere.&lt;/p&gt;
&lt;p&gt;To further elaborate, if the value of a register (or variable) a is 200.
To set bit x in that register, OR a with a mask value of 2^x^.&lt;/p&gt;
&lt;p&gt;Consider the following example (See Figure 1.). If the goal is to set
bit 5 in register a, the mask is 2^5^ = 32. The set operation then
becomes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;which is equivalent the following compound assignment statement:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a &lt;span style=&#34;color:#f92672&#34;&gt;|=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Alternatively 32 can be written as (1 &amp;lt;&amp;lt; 5) in C. This mask notation
is easier to read and immediately indicates to the reader/programmer
which bit is being set. The final operation becomes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a  &lt;span style=&#34;color:#f92672&#34;&gt;|=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig1-1.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 1. setting bit 5 in a register&amp;lt;/strong&amp;gt;&#34;  width=&#34;623&#34; height=&#34;267&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;In summary to set a bit x in register reg, use the following expression:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;|=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What if the programmer needs to set more than one bit in register reg,
say bit positions x, y and z?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;|=&lt;/span&gt; ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; y) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; z));
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;clearing-one-or-more-bits-in-a-register&#34;&gt;Clearing one or more bits in a register
&lt;/h2&gt;&lt;p&gt;The goal here is to clear one or more particular bit(s) in a register,
without disturbing the state of the other bits that are not of interest.
To achieve this, AND the current content of the register with a mask
value with zero(es) in the bit location(s) that we want to clear and
ones elsewhere.&lt;/p&gt;
&lt;p&gt;If the value of the register a is 200. To clear bit x in that register,
the content of register a is ANDed with a mask that is the &lt;strong&gt;inverted
(one&amp;rsquo;s complement)&lt;/strong&gt; value of 2^x^.&lt;/p&gt;
&lt;p&gt;For example, if the goal is to clear bit 6. the mask becomes the one&amp;rsquo;s
complement of 2^6^ = 64 which results in 191. Therefore to clear bit 6
in register a:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;191&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;which is equivalent to the following compound assignment statement&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;191&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Alternatively 191 can be written as ~(1 &amp;lt;&amp;lt; 6) in C. This mask
notation is much more readable as it indicates to the reader/programmer
which bit is being cleared without having to resort to doing decimal to
binary conversion.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;img src=&#34;fig2-1.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 2. clearing bit 6 in a register&amp;lt;/strong&amp;gt;&#34;  width=&#34;696&#34; height=&#34;425&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;In summary, to clear a bit x in register reg use the following
expression:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What if the programmer needs to clear more than one bit in register reg,
say bits x, y and z ?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; y) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; z));
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;toggling-one-or-more-bits-in-a-register&#34;&gt;Toggling one or more bits in a register
&lt;/h2&gt;&lt;p&gt;The goal here is to toggle one or more particular bit(s) in a register,
without disturbing the state of the other bits that are not of interest.
To achieve this, XOR the current content of the register with a mask
value with one(s) in the bit locations to be toggled and zeroes
elsewhere.&lt;/p&gt;
&lt;p&gt;For example if the value of a register a is 200, to toggle bit &amp;lsquo;x&amp;rsquo; in
that register, one will need to XOR a with a mask value of 2^x^.&lt;/p&gt;
&lt;p&gt;To further elaborate, If the goal is to toggle bit 5 in register a, the
mask is 2^5^ = 32. The set operation then becomes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt; ; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;which is equivalent to&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a &lt;span style=&#34;color:#f92672&#34;&gt;^=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;in shorthand notation. Alternatively 32 can be written as (1 &amp;lt;&amp;lt; 5) in
C.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a &lt;span style=&#34;color:#f92672&#34;&gt;^=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In summary, to toggle a bit x in register reg use the following
expression:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;^=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What if the programmer needs to toggle more than one bit in register
reg, say bits x,y and z ?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;^=&lt;/span&gt; ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; y) &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; z));
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;read-the-value-of-bit-in-a-registers&#34;&gt;Read the value of bit in a registers
&lt;/h2&gt;&lt;p&gt;To read the value of a bit x in a register &lt;code&gt;a&lt;/code&gt;, simply AND register &lt;code&gt;a&lt;/code&gt;
with a mask value of 2^x^ (i.e. all bit positions are 0&amp;rsquo;s except
position x).&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig3-1.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 3. Read a bit in a register (zero)&amp;lt;/strong&amp;gt;&#34;  width=&#34;626&#34; height=&#34;274&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;If the result is 0 then bit x in register a was 0(cleared). If the
result is non-zero, then bit x in register a was 1(set).&lt;/p&gt;
&lt;p&gt;
&lt;img src=&#34;fig4-1.jpg&#34; alt=&#34;&amp;lt;strong&amp;gt;Figure 4. Read a bit in a register
(non-zero)&amp;lt;/strong&amp;gt;&#34;  width=&#34;626&#34; height=&#34;274&#34;  /&gt;
&lt;/p&gt;
&lt;p&gt;For example to read the state of bit 5 in register &lt;strong&gt;a&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint8_t&lt;/span&gt; a , y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(y &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bit 5 in register a is zero&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bit 5 in register a is one&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In C, a non-zero value evaluates to true so the statement&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(y)Copy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;will evaluate to true if &amp;lsquo;y&amp;rsquo; is non-zero. Using this knowledge and
compund assignment notation, the previous code snippet becomes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bit 5 in register a is one&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bit 5 in register a is zero&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In some cases the programmer will want to return the exact state of the
bit in a register and not a non-zero value when the state of the bit is
one, and zero when the state of the bit is zero. This can be
accomplished with the ternary operator. If bit x in register a is 1, res
will be 1. else res will be zero.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;res &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ( &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x )) &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Another method of reading the state of a bit x in register a is to use
this statement:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;res &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This shifts the content of register a to the right by x bits, putting
the &amp;lsquo;xth&amp;rsquo; bit to be tested in the zeroth position. It is then ANDed with
one. If this bit is zero, the result of the operation is zero, else it
is one.&lt;/p&gt;
&lt;p&gt;In summary to read the state of bit x in register a with an if
statement:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bit x in register a is one&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bit x in register a is zero&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If the state of the bit is to be returned without an if statement, use
either&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;res &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ( &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x ) ) &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;or&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;res &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (a &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;building-a-bit-manipulation-library&#34;&gt;Building a bit manipulation library
&lt;/h2&gt;&lt;p&gt;Now with the knowledge of how RMW operations function, a quick library
that performs these operations can be built!&lt;/p&gt;
&lt;p&gt;The macro version should look like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define m_setBit(reg,x) reg |= (1 &amp;lt;&amp;lt; x)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define m_clearBit(reg,x) reg &amp;amp;= ~(1 &amp;lt;&amp;lt; x)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define m_toggleBit(reg,x) reg ^= (1 &amp;lt;&amp;lt; x)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define m_readBit(reg,x)  (reg &amp;gt;&amp;gt; x) &amp;amp; 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define m_readBit2(reg,x) (reg &amp;amp; ( 1&amp;lt;&amp;lt; x ) ) ? 1 : 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you are not a big fan of macros, the inline function version of the
library would look something like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;setBit&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; reg, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x){      &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;|=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x);}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clearBit&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; reg, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x){    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x);}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;toggleBit&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; reg, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x){   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;^=&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x);}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;readBit&lt;/span&gt;( &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; reg, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x){  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; x) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;readBit2&lt;/span&gt;( &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; reg, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; x){ &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;reg &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ( &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; x ) ) &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note that these macros/functions only modify one bit at a time.&lt;/p&gt;
&lt;p&gt;One last thing. The RMW operations introduced in this article are not
strictly atomic i.e. they will very likely not happen in a single
instruction cycle and may even take several instruction cycles to
execute. They merely give us bit granularity i.e. ensure that only the
bits of interest within a register are changed while keeping the state
of bits that are not of interest undisturbed.&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
